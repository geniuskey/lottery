<!DOCTYPE html>
<!--
  ë°¤ì†¡ì´ ì„œë°”ì´ë²Œ (Chestnut Survival)
  Copyright (c) 2025 Euiyun Kim (geniuskey@gmail.com)
-->
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ° ë°¤ì†¡ì´ ì„œë°”ì´ë²Œ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --sidebar-width: 280px;
      --sidebar-bg: #2a2d3a;
      --sidebar-dark: #1e2029;
      --accent: #8b5a2b;
      --accent-light: #d4a574;
      --sky-top: #87ceeb;
      --sky-bottom: #b0e2ff;
      --grass: #7cb342;
      --grass-dark: #558b2f;
      --tree-trunk: #6d4c41;
      --tree-leaves: #4caf50;
      --tree-leaves-dark: #388e3c;
      --chestnut: #8b4513;
      --chestnut-spikes: #5d3a1a;
      --danger: #ff6b6b;
      --success: #4caf50;
      --text-light: #e0e0e0;
      --text-muted: #9e9e9e;
    }
    
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--sidebar-dark);
      overflow: hidden;
      height: 100vh;
    }
    
    .container {
      display: flex;
      height: 100vh;
    }
    
    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--sidebar-bg);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: 100vh;
      z-index: 100;
    }
    
    .sidebar h1 {
      color: var(--accent-light);
      font-size: 1.5rem;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }
    
    .help-btn {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 50%;
      background: var(--sidebar-dark);
      color: var(--text-muted);
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .help-btn:hover {
      background: var(--accent);
      color: white;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    
    .modal-overlay.show {
      display: flex;
    }
    
    .modal {
      background: var(--sidebar-bg);
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    
    .modal h2 {
      color: var(--accent-light);
      font-size: 1.3rem;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 50%;
      background: var(--sidebar-dark);
      color: var(--text-muted);
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      color: var(--text-light);
    }
    
    .help-section {
      margin-bottom: 16px;
    }
    
    .help-section h3 {
      color: var(--text-light);
      font-size: 0.95rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .help-section p {
      color: var(--text-muted);
      font-size: 0.85rem;
      line-height: 1.5;
    }
    
    .sidebar > div:not(.rankings) {
      flex-shrink: 0;
    }

    .sidebar label {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-bottom: 4px;
      display: block;
    }
    
    .sidebar textarea {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: var(--sidebar-dark);
      color: var(--text-light);
      font-family: inherit;
      font-size: 0.9rem;
      resize: none;
      height: 80px;
    }
    
    .sidebar textarea::placeholder {
      color: var(--text-muted);
    }
    
    /* Settings */
    .settings-group {
      background: var(--sidebar-dark);
      border-radius: 8px;
      padding: 12px;
    }
    
    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .slider-container input[type="range"] {
      flex: 1;
      -webkit-appearance: none;
      background: #3a3d4a;
      height: 6px;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .slider-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--accent-light);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .slider-value {
      background: var(--sidebar-bg);
      color: var(--text-light);
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: 700;
      min-width: 40px;
      text-align: center;
    }
    
    /* Buttons */
    .btn-group {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    
    .btn {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 90, 43, 0.4);
    }
    
    .btn-primary:disabled {
      background: #4a4d5a;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-reset {
      flex: 0 0 50px;
      background: var(--sidebar-dark);
      color: var(--text-muted);
      font-size: 1.2rem;
    }
    
    .btn-reset:hover {
      color: var(--text-light);
    }
    
    /* Rankings */
    .rankings {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .rankings h3 {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-bottom: 8px;
    }
    
    .rankings-list {
      flex: 1;
      overflow-y: auto;
      background: var(--sidebar-dark);
      border-radius: 8px;
      padding: 8px;
    }
    
    .ranking-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 4px;
      transition: all 0.3s;
    }
    
    .ranking-item.alive {
      background: rgba(76, 175, 80, 0.1);
    }
    
    .ranking-item.dead {
      background: rgba(255, 107, 107, 0.1);
      opacity: 0.6;
    }
    
    .ranking-item.winner {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.1));
      animation: winner-glow 1s ease-in-out infinite alternate;
    }
    
    @keyframes winner-glow {
      from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
      to { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
    }
    
    .status-icon {
      font-size: 1rem;
      min-width: 1.2rem;
      display: flex;
      justify-content: center;
    }
    
    .ranking-emoji {
      font-size: 1.1rem;
      margin-right: 4px;
    }
    
    .ranking-name {
      flex: 1;
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .death-time {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: 'Orbitron', sans-serif;
    }
    
    /* Sidebar Footer */
    .sidebar-footer {
      display: flex;
      justify-content: center;
      gap: 12px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 8px;
      background: var(--sidebar-dark);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      position: relative;
      text-decoration: none;
    }
    
    .icon-btn:hover {
      color: var(--text-light);
      transform: translateY(-2px);
    }
    
    .icon-btn[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--sidebar-dark);
      color: var(--text-light);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      margin-bottom: 8px;
    }
    
    /* Game Area */
    .game-area {
      flex: 1;
      position: relative;
      overflow: hidden;
      transition: transform 0.1s;
    }
    
    .game-area.shake {
      animation: shake 0.2s double infinite;
    }
    
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(5px, 5px); }
      50% { transform: translate(-5px, -5px); }
      75% { transform: translate(5px, -5px); }
      100% { transform: translate(0, 0); }
    }
    
    .danger-ui {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 107, 107, 0.9);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 900;
      font-size: 1.2rem;
      letter-spacing: 2px;
      display: none;
      animation: pulse 0.5s infinite alternate;
      z-index: 10;
      pointer-events: none;
    }
    
    .game-timer {
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      color: #ffd700;
      padding: 5px 20px;
      border-radius: 30px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      font-weight: 900;
      border: 2px solid rgba(255, 215, 0, 0.3);
      z-index: 20;
      pointer-events: none;
      min-width: 120px;
      text-align: center;
      display: none;
    }
    
    @keyframes pulse {
      from { transform: translateX(-50%) scale(1); opacity: 0.8; }
      to { transform: translateX(-50%) scale(1.1); opacity: 1; }
    }
    
    #gameCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    .copyright {
      position: absolute;
      bottom: 10px;
      right: 15px;
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.25);
      pointer-events: none;
      user-select: none;
    }
    
    /* Game Over Overlay */
    .game-over-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 50;
    }
    
    .game-over-overlay.show {
      display: flex;
    }
    
    .game-over-content {
      text-align: center;
      color: white;
    }
    
    .game-over-content h2 {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    
    .winners-list {
      font-size: 1.5rem;
      margin-bottom: 30px;
    }
    
    .winner-name {
      display: inline-block;
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #333;
      padding: 8px 20px;
      border-radius: 20px;
      margin: 5px;
      font-weight: 700;
    }
    
    .btn-confirm {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #333;
      border: none;
      padding: 14px 40px;
      border-radius: 30px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }
    
    .btn-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
    }
    
    /* Confetti */
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      pointer-events: none;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        position: fixed;
        bottom: 0;
        height: auto;
        max-height: 45vh;
        border-radius: 20px 20px 0 0;
        overflow-y: auto;
      }
      
      .game-area {
        height: 55vh;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="header-row">
        <h1>ğŸŒ° ë°¤ì†¡ì´ ì„œë°”ì´ë²Œ</h1>
        <button class="help-btn" id="helpBtn">?</button>
      </div>
      
      <div>
        <label>ì°¸ì—¬ì</label>
        <textarea id="participants" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì¤„ë°”ê¿ˆ ë˜ëŠ” ì‰¼í‘œ)&#10;ì˜ˆ: ì² ìˆ˜, ì˜í¬*3, ë¯¼ìˆ˜">ì˜ìˆ˜, ì˜í˜¸, ì˜ì‹, ì˜ì² , ê´‘ìˆ˜, ìƒì² </textarea>
      </div>
      
      <div class="settings-group">
        <label>ìµœì¢… ìƒì¡´ì ìˆ˜</label>
        <div class="slider-container">
          <input type="range" id="survivorCount" min="1" max="10" value="1">
          <span class="slider-value" id="survivorValue">1</span>
        </div>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-primary" id="startBtn">ğŸ® ì‹œì‘</button>
        <button class="btn btn-reset" id="resetBtn">â†º</button>
      </div>
      
      <div class="rankings">
        <h3>ì‹¤ì‹œê°„ í˜„í™©</h3>
        <div class="rankings-list" id="rankingsList"></div>
      </div>
      
      <div class="sidebar-footer">
        <a href="https://geniuskey.github.io/lottery/" class="icon-btn" data-tooltip="ì¶”ì²¨ í¬íƒˆ í™ˆ">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        </a>
        <button class="icon-btn" id="copyResultBtn" data-tooltip="ê²°ê³¼ ë³µì‚¬">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        </button>
        <a href="https://github.com/geniuskey/lottery" target="_blank" class="icon-btn" data-tooltip="GitHub ì €ì¥ì†Œ">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>
        </a>
        <a href="https://buymeacoffee.com/euiyun" target="_blank" class="icon-btn" data-tooltip="ì»¤í”¼ ì‚¬ì£¼ê¸° â˜•">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364z"></path></svg>
        </a>
      </div>
    </aside>
    
    <main class="game-area">
      <div class="game-timer" id="gameTimer">00:00.0</div>
      <div class="danger-ui" id="dangerUI">âš ï¸ ìœ„í—˜! ê°€ì† ëª¨ë“œ âš ï¸</div>
      <canvas id="gameCanvas"></canvas>
      <div class="copyright">Â© 2025 Euiyun Edwin Kim</div>
      <div class="game-over-overlay" id="gameOverOverlay">
        <div class="game-over-content">
          <h2>ğŸ‰ ìƒì¡´ì ë°œí‘œ!</h2>
          <div class="winners-list" id="winnersList"></div>
          <button class="btn-confirm" id="confirmBtn">í™•ì¸</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Help Modal -->
  <div class="modal-overlay" id="helpModal">
    <div class="modal">
      <button class="modal-close" id="modalClose">Ã—</button>
      <h2>ğŸŒ° ê²Œì„ ë°©ë²•</h2>
      
      <div class="help-section">
        <h3>ğŸ¯ ê²Œì„ ëª©í‘œ</h3>
        <p>ë‚˜ë¬´ì—ì„œ ë–¨ì–´ì§€ëŠ” ë°¤ì†¡ì´ë¥¼ í”¼í•´ ëê¹Œì§€ ì‚´ì•„ë‚¨ìœ¼ì„¸ìš”! ì„¤ì •í•œ ìƒì¡´ì ìˆ˜ë§Œí¼ ë‚¨ìœ¼ë©´ ê²Œì„ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</p>
      </div>
      
      <div class="help-section">
        <h3>ğŸ‘¥ ì°¸ì—¬ì ì„¤ì •</h3>
        <p>ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì°¸ì—¬ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”. ìµœì†Œ 2ëª… ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.</p>
      </div>
      
      <div class="help-section">
        <h3>ğŸ† ìµœì¢… ìƒì¡´ì ìˆ˜</h3>
        <p>ìŠ¬ë¼ì´ë”ë¡œ ìµœì¢… ìƒì¡´ì ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. í•´ë‹¹ ì¸ì›ë§Œ ë‚¨ìœ¼ë©´ ê²Œì„ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</p>
      </div>
      
      <div class="help-section">
        <h3>ğŸ® ê²Œì„ ì§„í–‰</h3>
        <p>ì°¸ì—¬ìë“¤ì€ ìë™ìœ¼ë¡œ ì¢Œìš°ë¡œ ì›€ì§ì´ë©°, ë°¤ì†¡ì´ì— ë§ìœ¼ë©´ íƒˆë½í•©ë‹ˆë‹¤. ìš´ì— ë§¡ê¸°ì„¸ìš”!</p>
      </div>
      
      <div class="help-section">
        <h3>ğŸ“‹ ê²°ê³¼ ë³µì‚¬</h3>
        <p>ê²Œì„ ì¢…ë£Œ í›„ í•˜ë‹¨ì˜ ë³µì‚¬ ë²„íŠ¼ìœ¼ë¡œ ê²°ê³¼ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    </div>
  </div>

  <script>
    // Copyright (c) 2025 Euiyun Kim (geniuskey@gmail.com)
    
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Game state
    let gameRunning = false;
    let participants = [];
    let players = [];
    let chestnuts = [];
    let trees = [];
    let clouds = [];
    let birds = [];
    let targetSurvivors = 1;
    let animationId = null;
    let gameTimeSeconds = 0; // ì´ˆ ë‹¨ìœ„ë¡œ ë³€ê²½
    let difficultyMultiplier = 1.0;
    let lastTimestamp = 0;
    
    // Caching for performance
    const treeCanvas = document.createElement('canvas');
    const treeCtx = treeCanvas.getContext('2d');
    const chestnutCache = document.createElement('canvas');
    const chestnutCtx = chestnutCache.getContext('2d');
    let chestnutCacheSize = 40; // ìµœëŒ€ í¬ê¸° ê¸°ì¤€
    const happyEmojis = ['ğŸ˜Š', 'ğŸ˜„', 'ğŸ˜', 'ğŸ™‚', 'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ¤—', 'ğŸ˜‹', 'ğŸ¤©', 'ğŸ¥³'];
    // Hurt emojis for dead players
    const hurtEmojis = ['ğŸ˜µ', 'ğŸ˜µâ€ğŸ’«', 'ğŸ¥´', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ¤•', 'ğŸ˜«', 'ğŸ’€'];
    
    // Pre-render chestnut for performance
    function cacheChestnut() {
      const r = 20; // Base size for cache
      const padding = 10;
      chestnutCache.width = (r + padding) * 2;
      chestnutCache.height = (r + padding) * 2;
      chestnutCacheSize = r;
      
      chestnutCtx.translate(r + padding, r + padding);
      
      // Main body
      chestnutCtx.fillStyle = '#8B4513';
      chestnutCtx.beginPath();
      chestnutCtx.arc(0, 0, r, 0, Math.PI * 2);
      chestnutCtx.fill();
      
      // Spikes
      chestnutCtx.strokeStyle = '#5D3A1A';
      chestnutCtx.lineWidth = 1.4;
      const spikeCount = 20;
      for (let i = 0; i < spikeCount; i++) {
        const angle = (i / spikeCount) * Math.PI * 2;
        const innerR = r * 0.85;
        const outerR = r * 1.35;
        chestnutCtx.beginPath();
        chestnutCtx.moveTo(Math.cos(angle) * innerR, Math.sin(angle) * innerR);
        chestnutCtx.lineTo(Math.cos(angle) * outerR, Math.sin(angle) * outerR);
        chestnutCtx.stroke();
      }
      
      // Highlight
      chestnutCtx.fillStyle = 'rgba(255, 255, 255, 0.2)';
      chestnutCtx.beginPath();
      chestnutCtx.ellipse(-r * 0.3, -r * 0.3, r * 0.3, r * 0.2, -0.5, 0, Math.PI * 2);
      chestnutCtx.fill();
    }

    // Resize canvas
    function resizeCanvas() {
      canvas.width = canvas.parentElement.clientWidth;
      canvas.height = canvas.parentElement.clientHeight;
      
      // Update background cache
      treeCanvas.width = canvas.width;
      treeCanvas.height = canvas.height;
      
      if (!gameRunning) {
        generateTrees();
        generateClouds();
        generateBirds();
        cacheChestnut();
        updateBackgroundCache();
        draw();
      }
    }

    function updateBackgroundCache() {
      treeCtx.clearRect(0, 0, treeCanvas.width, treeCanvas.height);
      drawSky(treeCtx);
      drawGrass(treeCtx);
      trees.forEach(tree => drawTree(treeCtx, tree));
    }
    
    // Draw chestnut (ë°¤ì†¡ì´)
    function drawChestnut(chestnut) {
      ctx.save();
      ctx.translate(chestnut.x, chestnut.y);
      ctx.rotate(chestnut.rotation);
      
      const r = chestnut.radius;
      const scale = r / chestnutCacheSize;
      
      // Use cached canvas for drawing
      ctx.drawImage(
        chestnutCache, 
        -(r + 10), 
        -(r + 10), 
        (r + 10) * 2, 
        (r + 10) * 2
      );
      
      ctx.restore();
    }
    
    // Generate trees
    function generateTrees() {
      trees = [];
      // ì¼ì •í•œ ë°€ë„ë¡œ ë‚˜ë¬´ ë°°ì¹˜ (120px ê°„ê²© ê¸°ì¤€)
      const treeSpacing = 120;
      const treeCount = Math.max(3, Math.floor(canvas.width / treeSpacing) + 1);
      for (let i = 0; i < treeCount; i++) {
        trees.push({
          x: (i + 0.5) * (canvas.width / treeCount) + (Math.random() - 0.5) * 40,
          width: 110 + Math.random() * 70,
          height: 225 + Math.random() * 150,
          trunkWidth: 32 + Math.random() * 22,
          trunkHeight: 140 + Math.random() * 95,
          leafLayers: 2 + Math.floor(Math.random() * 2)
        });
      }
      
      // ìº”ë²„ìŠ¤ í¬ê¸° ê¸°ë°˜ ìŠ¤í°ìœ¨ ê³„ì‚° (ê¸°ì¤€: 1000px ë„ˆë¹„)
      baseSpawnRate = 0.024 * (canvas.width / 1000);
    }
    
    let baseSpawnRate = 0.024;
    
    // Generate clouds
    function generateClouds() {
      clouds = [];
      const cloudCount = Math.floor(canvas.width / 250) + 2;
      for (let i = 0; i < cloudCount; i++) {
        clouds.push({
          x: Math.random() * canvas.width,
          y: 30 + Math.random() * (canvas.height * 0.25),
          width: 80 + Math.random() * 60,
          speed: 0.2 + Math.random() * 0.3,
          opacity: 0.6 + Math.random() * 0.3
        });
      }
    }
    
    // Generate birds
    function generateBirds() {
      birds = [];
      const birdCount = 3 + Math.floor(Math.random() * 3);
      for (let i = 0; i < birdCount; i++) {
        birds.push({
          x: Math.random() * canvas.width,
          y: 50 + Math.random() * (canvas.height * 0.2),
          speed: 1 + Math.random() * 1.5,
          wingPhase: Math.random() * Math.PI * 2,
          size: 8 + Math.random() * 6
        });
      }
    }
    
    // Create chestnut - ë‚˜ë¬´ ìœ„ì¹˜ì—ì„œ ë–¨ì–´ì§€ê²Œ
    function createChestnut() {
      // ëœë¤í•œ ë‚˜ë¬´ ì„ íƒ
      const tree = trees[Math.floor(Math.random() * trees.length)];
      const x = tree.x + (Math.random() - 0.5) * tree.width * 0.8;
      const baseY = canvas.height * 0.65;
      // ìƒì„± ë†’ì´ë¥¼ 10% ë‚®ì¶¤ (ì§€ë©´ê³¼ì˜ ê±°ë¦¬ë¥¼ 0.9ë°°ë¡œ ì¡°ì ˆ)
      const startY = baseY - (tree.trunkHeight + tree.height * 0.8) * 0.9;
      
      return {
        x: x,
        y: startY,
        vy: 0,
        radius: 12 + Math.random() * 8,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.1
      };
    }
    
    // Initialize players
    function initPlayers() {
      const groundYBase = canvas.height - 80;
      const groundYRange = 60; // Y ë²”ìœ„
      players = participants.map((name, i) => ({
        name: name,
        x: 100 + Math.random() * (canvas.width - 200),
        y: groundYBase + Math.random() * groundYRange, // ëœë¤ Y ê°’
        vx: (Math.random() - 0.5) * 3.0, // ì†ë„ 2ë°° ìƒí–¥ (1.5 -> 3.0)
        alive: true,
        emoji: happyEmojis[Math.floor(Math.random() * happyEmojis.length)],
        size: 40,
        direction: 1,
        changeTimer: Math.random() * 100,
        deathTimeSeconds: null
      }));
    }
    
    // Format time (SS.sss)
    function formatTime(frames) {
      const seconds = frames / 60;
      return seconds.toFixed(3) + 's';
    }
    
    function formatTimeSeconds(seconds) {
      return seconds.toFixed(3) + 's';
    }
    
    // Draw sky
    function drawSky(targetCtx) {
      const gradient = targetCtx.createLinearGradient(0, 0, 0, canvas.height * 0.7);
      gradient.addColorStop(0, '#87CEEB');
      gradient.addColorStop(1, '#B0E2FF');
      targetCtx.fillStyle = gradient;
      targetCtx.fillRect(0, 0, canvas.width, canvas.height * 0.7);
      
      // Draw sun
      const sunX = canvas.width - 80;
      const sunY = 70;
      const sunRadius = 40;
      
      // Sun glow
      const sunGlow = targetCtx.createRadialGradient(sunX, sunY, 0, sunX, sunY, sunRadius * 2);
      sunGlow.addColorStop(0, 'rgba(255, 236, 179, 0.8)');
      sunGlow.addColorStop(0.5, 'rgba(255, 236, 179, 0.2)');
      sunGlow.addColorStop(1, 'rgba(255, 236, 179, 0)');
      targetCtx.fillStyle = sunGlow;
      targetCtx.beginPath();
      targetCtx.arc(sunX, sunY, sunRadius * 2, 0, Math.PI * 2);
      targetCtx.fill();
      
      // Sun body
      targetCtx.fillStyle = '#FFE082';
      targetCtx.beginPath();
      targetCtx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
      targetCtx.fill();
      
      // Sun rays
      targetCtx.strokeStyle = 'rgba(255, 224, 130, 0.5)';
      targetCtx.lineWidth = 3;
      for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2 + Date.now() * 0.0003;
        const innerR = sunRadius + 5;
        const outerR = sunRadius + 20;
        targetCtx.beginPath();
        targetCtx.moveTo(sunX + Math.cos(angle) * innerR, sunY + Math.sin(angle) * innerR);
        targetCtx.lineTo(sunX + Math.cos(angle) * outerR, sunY + Math.sin(angle) * outerR);
        targetCtx.stroke();
      }
    }
    
    // Draw clouds
    function drawClouds() {
      clouds.forEach(cloud => {
        ctx.fillStyle = `rgba(255, 255, 255, ${cloud.opacity})`;
        
        // Cloud shape with multiple circles
        const w = cloud.width;
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, w * 0.3, 0, Math.PI * 2);
        ctx.arc(cloud.x + w * 0.25, cloud.y - w * 0.1, w * 0.25, 0, Math.PI * 2);
        ctx.arc(cloud.x + w * 0.5, cloud.y, w * 0.3, 0, Math.PI * 2);
        ctx.arc(cloud.x + w * 0.25, cloud.y + w * 0.08, w * 0.2, 0, Math.PI * 2);
        ctx.fill();
        
        // Move cloud
        cloud.x += cloud.speed;
        if (cloud.x > canvas.width + cloud.width) {
          cloud.x = -cloud.width;
          cloud.y = 30 + Math.random() * (canvas.height * 0.25);
        }
      });
    }
    
    // Draw birds
    function drawBirds() {
      birds.forEach(bird => {
        const wingAngle = Math.sin(bird.wingPhase) * 0.5;
        bird.wingPhase += 0.15;
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        
        // Left wing
        ctx.beginPath();
        ctx.moveTo(bird.x, bird.y);
        ctx.quadraticCurveTo(
          bird.x - bird.size * 0.5, 
          bird.y - bird.size * wingAngle,
          bird.x - bird.size, 
          bird.y + bird.size * 0.3 * wingAngle
        );
        ctx.stroke();
        
        // Right wing
        ctx.beginPath();
        ctx.moveTo(bird.x, bird.y);
        ctx.quadraticCurveTo(
          bird.x + bird.size * 0.5, 
          bird.y - bird.size * wingAngle,
          bird.x + bird.size, 
          bird.y + bird.size * 0.3 * wingAngle
        );
        ctx.stroke();
        
        // Move bird
        bird.x += bird.speed;
        if (bird.x > canvas.width + bird.size * 2) {
          bird.x = -bird.size * 2;
          bird.y = 50 + Math.random() * (canvas.height * 0.2);
        }
      });
    }
    
    // Draw grass
    function drawGrass(targetCtx) {
      const grassTop = canvas.height * 0.6;
      const gradient = targetCtx.createLinearGradient(0, grassTop, 0, canvas.height);
      gradient.addColorStop(0, '#7CB342');
      gradient.addColorStop(0.3, '#8BC34A');
      gradient.addColorStop(1, '#558B2F');
      targetCtx.fillStyle = gradient;
      targetCtx.beginPath();
      targetCtx.moveTo(0, grassTop);
      // Wavy grass top
      for (let x = 0; x <= canvas.width; x += 20) {
        targetCtx.lineTo(x, grassTop + Math.sin(x * 0.03) * 10);
      }
      targetCtx.lineTo(canvas.width, canvas.height);
      targetCtx.lineTo(0, canvas.height);
      targetCtx.closePath();
      targetCtx.fill();
    }
    
    // Draw tree
    function drawTree(targetCtx, tree) {
      const baseY = canvas.height * 0.65;
      
      // Trunk
      targetCtx.fillStyle = '#6D4C41';
      targetCtx.fillRect(
        tree.x - tree.trunkWidth / 2,
        baseY - tree.trunkHeight,
        tree.trunkWidth,
        tree.trunkHeight + 20
      );
      
      // Trunk details
      targetCtx.strokeStyle = '#5D4037';
      targetCtx.lineWidth = 2;
      for (let i = 0; i < 3; i++) {
        const lineY = baseY - tree.trunkHeight + 20 + i * 25;
        targetCtx.beginPath();
        targetCtx.moveTo(tree.x - tree.trunkWidth / 2 + 5, lineY);
        targetCtx.lineTo(tree.x + tree.trunkWidth / 2 - 5, lineY + 10);
        targetCtx.stroke();
      }
      
      // Leaves (multiple layers for depth)
      for (let layer = 0; layer < tree.leafLayers; layer++) {
        const layerOffset = layer * 30;
        const layerScale = 1 - layer * 0.15;
        
        // Back leaves (darker)
        targetCtx.fillStyle = layer === 0 ? '#388E3C' : '#43A047';
        targetCtx.beginPath();
        targetCtx.ellipse(
          tree.x,
          baseY - tree.trunkHeight - tree.height * 0.4 - layerOffset,
          tree.width * 0.6 * layerScale,
          tree.height * 0.5 * layerScale,
          0, 0, Math.PI * 2
        );
        targetCtx.fill();
        
        // Front leaves (lighter)
        targetCtx.fillStyle = layer === 0 ? '#4CAF50' : '#66BB6A';
        targetCtx.beginPath();
        targetCtx.ellipse(
          tree.x + 10,
          baseY - tree.trunkHeight - tree.height * 0.35 - layerOffset,
          tree.width * 0.5 * layerScale,
          tree.height * 0.4 * layerScale,
          0, 0, Math.PI * 2
        );
        targetCtx.fill();
      }
    }
    
    // Draw chestnut (ë°¤ì†¡ì´)
    function drawChestnut(chestnut) {
      ctx.save();
      ctx.translate(chestnut.x, chestnut.y);
      ctx.rotate(chestnut.rotation);
      
      const r = chestnut.radius;
      
      // Main body
      ctx.fillStyle = '#8B4513';
      ctx.beginPath();
      ctx.arc(0, 0, r, 0, Math.PI * 2);
      ctx.fill();
      
      // Spikes - ë” ì´˜ì´˜í•˜ê³  ì–‡ê²Œ
      ctx.strokeStyle = '#5D3A1A';
      ctx.lineWidth = 1.4; // 30% ê°ì†Œ (2 -> 1.4)
      const spikeCount = 20; // 12 -> 20 ë” ì´˜ì´˜
      for (let i = 0; i < spikeCount; i++) {
        const angle = (i / spikeCount) * Math.PI * 2;
        const innerR = r * 0.85;
        const outerR = r * 1.35;
        ctx.beginPath();
        ctx.moveTo(Math.cos(angle) * innerR, Math.sin(angle) * innerR);
        ctx.lineTo(Math.cos(angle) * outerR, Math.sin(angle) * outerR);
        ctx.stroke();
      }
      
      // Highlight
      ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
      ctx.beginPath();
      ctx.ellipse(-r * 0.3, -r * 0.3, r * 0.3, r * 0.2, -0.5, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.restore();
    }
    
    // Draw player
    function drawPlayer(player) {
      const size = player.size;
      const alpha = player.alive ? 1 : 0.4; // ì£½ìœ¼ë©´ íˆ¬ëª…í•˜ê²Œ
      
      ctx.save();
      ctx.globalAlpha = alpha;
      
      // Name tag
      ctx.font = '12px "Noto Sans KR"';
      const textWidth = ctx.measureText(player.name).width + 16;
      
      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
      ctx.beginPath();
      ctx.roundRect(player.x - textWidth / 2, player.y - size - 35, textWidth, 22, 6);
      ctx.fill();
      
      ctx.fillStyle = 'white';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(player.name, player.x, player.y - size - 24); // ì¤‘ì•™ ì •ë ¬
      
      // Emoji face
      ctx.font = `${size}px Arial`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(player.emoji, player.x, player.y - size / 2);
      
      ctx.restore();
    }
    
    // Update game
    function update(dt) {
      const dtScale = dt * 60; // 60fps ê¸°ì¤€ ìŠ¤ì¼€ì¼
      gameTimeSeconds += dt;
      
      // Update Timer Display
      document.getElementById('gameTimer').textContent = formatTimeSeconds(gameTimeSeconds);
      
      const totalInitial = participants.length;
      const alivePlayers = players.filter(p => p.alive);
      const aliveCount = alivePlayers.length;
      
      // Difficulty escalation starts after 10 seconds
      const timeInSeconds = gameTimeSeconds;
      let timeScaling = 0;
      if (timeInSeconds > 10) {
        timeScaling = (timeInSeconds - 10) * 0.08;
      }
      
      const deathRatio = (totalInitial - aliveCount) / (totalInitial - targetSurvivors);
      difficultyMultiplier = 1.0 + timeScaling + (deathRatio * 0.7);
      
      // Update Danger UI
      const dangerUI = document.getElementById('dangerUI');
      if (timeInSeconds > 10) {
        dangerUI.style.display = 'block';
        if (timeInSeconds > 20) {
          dangerUI.textContent = "ğŸ”¥ ì´ˆê³ ì† ëª¨ë“œ!! ğŸ”¥";
          dangerUI.style.background = "rgba(255, 0, 0, 0.9)";
        } else {
          dangerUI.textContent = "âš ï¸ ìœ„í—˜! ê°€ì† ëª¨ë“œ âš ï¸";
          dangerUI.style.background = "rgba(255, 107, 107, 0.9)";
        }
      } else {
        dangerUI.style.display = 'none';
      }
      
      const gravity = 0.13 * difficultyMultiplier * dtScale;
      const spawnRate = baseSpawnRate * difficultyMultiplier * dtScale;
      
      // Check if game should end
      if (alivePlayers.length <= targetSurvivors) {
        endGame();
        return;
      }
      
      // Spawn new chestnuts
      if (Math.random() < spawnRate) {
        chestnuts.push(createChestnut());
      }
      
      // Update chestnuts
      chestnuts.forEach(c => {
        c.vy += gravity;
        c.y += c.vy * dtScale;
        c.rotation += c.rotationSpeed * difficultyMultiplier * dtScale;
      });
      
      // Remove off-screen chestnuts
      chestnuts = chestnuts.filter(c => c.y < canvas.height + 50);
      
      // Update players
      players.forEach(player => {
        if (!player.alive) return;
        
        const moveSpeed = 3.0 * (1 + deathRatio * 0.8);
        
        player.changeTimer -= dtScale;
        if (player.changeTimer <= 0) {
          player.vx = (Math.random() - 0.5) * moveSpeed * 2;
          player.changeTimer = (50 + Math.random() * 100) / difficultyMultiplier;
          player.emoji = happyEmojis[Math.floor(Math.random() * happyEmojis.length)];
        }
        
        player.x += player.vx * dtScale;
        
        if (player.x < 50) {
          player.x = 50;
          player.vx = Math.abs(player.vx);
        }
        if (player.x > canvas.width - 50) {
          player.x = canvas.width - 50;
          player.vx = -Math.abs(player.vx);
        }
        
        // Check collision with chestnuts
        chestnuts.forEach(c => {
          const dx = player.x - c.x;
          const dy = (player.y - player.size / 2) - c.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          
          if (dist < player.size / 2 + c.radius) {
            player.alive = false;
            player.deathTimeSeconds = gameTimeSeconds;
            player.emoji = hurtEmojis[Math.floor(Math.random() * hurtEmojis.length)];
            
            const gameArea = document.querySelector('.game-area');
            gameArea.classList.add('shake');
            setTimeout(() => gameArea.classList.remove('shake'), 200);
            
            updateRankings();
          }
        });
      });
    }

    // Draw danger indicators
    function drawDangerIndicators() {
      ctx.save();
      chestnuts.forEach(c => {
        // Only show indicators for chestnuts above a certain height
        if (c.y < canvas.height - 150) {
          const groundY = canvas.height - 100; // Rough ground Y
          const timeLeft = Math.sqrt((groundY - c.y) / 0.1); // Rough approximation
          
          // Draw a pulsing shadow on the ground
          const opacity = Math.min(0.4, (c.y / canvas.height));
          const size = c.radius * (1 + Math.sin(gameTimeSeconds * 60 * 0.2) * 0.2);
          
          ctx.fillStyle = `rgba(0, 0, 0, ${opacity * 0.8})`; // Gray/Shadow color
          ctx.beginPath();
          ctx.ellipse(c.x, groundY + 30, size * 1.5, size * 0.5, 0, 0, Math.PI * 2);
          ctx.fill();
        }
      });
      ctx.restore();
    }
    
    // Draw everything
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Use cached background
      ctx.drawImage(treeCanvas, 0, 0);
      
      drawClouds();
      drawBirds();
      
      drawDangerIndicators();
      
      chestnuts.forEach(drawChestnut);
      
      [...players].sort((a, b) => a.y - b.y).forEach(drawPlayer);
    }
    
    // Game loop
    function gameLoop(timestamp) {
      if (!gameRunning) return;
      
      if (!lastTimestamp) lastTimestamp = timestamp;
      const dt = (timestamp - lastTimestamp) / 1000;
      lastTimestamp = timestamp;

      // Limit dt to prevent glitches (e.g. from tab switching)
      const cappedDt = Math.min(dt, 0.1);
      
      update(cappedDt);
      draw();
      animationId = requestAnimationFrame(gameLoop);
    }
    
    // Update rankings display
    function updateRankings() {
      const list = document.getElementById('rankingsList');
      list.innerHTML = '';
      
      // Sort: alive first, then by deathTimeSeconds (descending), then by name
      const sorted = [...players].sort((a, b) => {
        if (a.alive !== b.alive) return b.alive - a.alive;
        if (!a.alive && !b.alive) return b.deathTimeSeconds - a.deathTimeSeconds;
        return a.name.localeCompare(b.name);
      });
      
      sorted.forEach(player => {
        const item = document.createElement('div');
        item.className = `ranking-item ${player.alive ? 'alive' : 'dead'}`;
        
        let timeInfo = '';
        if (!player.alive && player.deathTimeSeconds) {
          timeInfo = `<span class="death-time">${formatTimeSeconds(player.deathTimeSeconds)}</span>`;
        }
        
        item.innerHTML = `
          <span class="status-icon">${player.alive ? 'âœ“' : 'âœ—'}</span>
          <span class="ranking-emoji">${player.emoji}</span>
          <span class="ranking-name">${player.name}</span>
          ${timeInfo}
        `;
        list.appendChild(item);
      });
    }
    
    // End game
    function endGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      const winners = players.filter(p => p.alive);
      const finalTime = formatTimeSeconds(gameTimeSeconds);
      
      // Update rankings with winner highlights
      const list = document.getElementById('rankingsList');
      list.querySelectorAll('.ranking-item.alive').forEach(item => {
        item.classList.add('winner');
        const timeSpan = document.createElement('span');
        timeSpan.className = 'death-time';
        timeSpan.textContent = finalTime;
        item.appendChild(timeSpan);
      });
      
      // Show game over overlay
      const overlay = document.getElementById('gameOverOverlay');
      const winnersList = document.getElementById('winnersList');
      winnersList.innerHTML = `
        <div style="margin-bottom: 15px; font-size: 1.2rem; color: #aaa;">ìƒì¡´ ì‹œê°„: ${finalTime}</div>
        ${winners.map(w => `<span class="winner-name">${w.emoji} ${w.name}</span>`).join('')}
      `;
      overlay.classList.add('show');
      
      // Confetti
      createConfetti();
      
      document.getElementById('startBtn').disabled = false;
    }
    
    // Create confetti
    function createConfetti() {
      const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da'];
      const gameArea = document.querySelector('.game-area');
      
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          gameArea.appendChild(confetti);
          
          // Animate
          const duration = 2000 + Math.random() * 2000;
          const startX = parseFloat(confetti.style.left);
          const drift = (Math.random() - 0.5) * 20;
          
          confetti.animate([
            { top: '-10px', left: startX + '%', opacity: 1 },
            { top: '100%', left: (startX + drift) + '%', opacity: 0 }
          ], {
            duration: duration,
            easing: 'ease-out'
          }).onfinish = () => confetti.remove();
        }, i * 30);
      }
    }
    
    // ì°¸ì—¬ì íŒŒì‹± í•¨ìˆ˜
    function parseParticipants(text) {
      const names = text.split(/[,\n]/).map(n => n.trim()).filter(n => n);
      const result = [];
      for (const name of names) {
        const match = name.match(/^(.+)\*(\d+)$/);
        if (match) {
          const baseName = match[1].trim();
          const count = parseInt(match[2]);
          for (let i = 0; i < count; i++) result.push(baseName);
        } else {
          result.push(name);
        }
      }
      return result;
    }

    // Start game
    function startGame() {
      const input = document.getElementById('participants').value;
      participants = parseParticipants(input);
      
      if (participants.length < 2) {
        alert('ìµœì†Œ 2ëª…ì˜ ì°¸ì—¬ìê°€ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      
      targetSurvivors = parseInt(document.getElementById('survivorCount').value);
      if (targetSurvivors >= participants.length) {
        alert('ìƒì¡´ì ìˆ˜ëŠ” ì°¸ì—¬ì ìˆ˜ë³´ë‹¤ ì ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      // Reset
      document.getElementById('gameOverOverlay').classList.remove('show');
      document.getElementById('dangerUI').style.display = 'none';
      document.getElementById('gameTimer').style.display = 'block';
      chestnuts = [];
      gameTimeSeconds = 0;
      lastTimestamp = 0;
      difficultyMultiplier = 1.0;
      initPlayers();
      updateRankings();
      
      gameRunning = true;
      document.getElementById('startBtn').disabled = true;
      requestAnimationFrame(gameLoop);
    }
    
    // Reset game
    function resetGame() {
      gameRunning = false;
      cancelAnimationFrame(animationId);
      
      chestnuts = [];
      players = [];
      document.getElementById('rankingsList').innerHTML = '';
      document.getElementById('gameOverOverlay').classList.remove('show');
      document.getElementById('dangerUI').style.display = 'none';
      document.getElementById('gameTimer').style.display = 'none';
      document.getElementById('startBtn').disabled = false;
      
      draw();
    }
    
    // Copy results
    function copyResults() {
      const winners = players.filter(p => p.alive);
      const losers = players.filter(p => !p.alive);
      
      let result = 'ğŸŒ° ë°¤ì†¡ì´ ì„œë°”ì´ë²Œ ê²°ê³¼\n\n';
      result += 'ğŸ† ìƒì¡´ì:\n';
      winners.forEach(w => result += `  ${w.name}\n`);
      result += '\nğŸ’€ íƒˆë½ì:\n';
      losers.forEach(l => result += `  ${l.name}\n`);
      
      navigator.clipboard.writeText(result).then(() => {
        const btn = document.getElementById('copyResultBtn');
        btn.dataset.tooltip = 'ë³µì‚¬ë¨!';
        setTimeout(() => btn.dataset.tooltip = 'ê²°ê³¼ ë³µì‚¬', 2000);
      });
    }
    
    // Event listeners
    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('resetBtn').addEventListener('click', resetGame);
    document.getElementById('copyResultBtn').addEventListener('click', copyResults);
    document.getElementById('confirmBtn').addEventListener('click', () => {
      document.getElementById('gameOverOverlay').classList.remove('show');
    });
    
    // Help modal
    document.getElementById('helpBtn').addEventListener('click', () => {
      document.getElementById('helpModal').classList.add('show');
    });
    document.getElementById('modalClose').addEventListener('click', () => {
      document.getElementById('helpModal').classList.remove('show');
    });
    document.getElementById('helpModal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        document.getElementById('helpModal').classList.remove('show');
      }
    });
    
    document.getElementById('survivorCount').addEventListener('input', (e) => {
      document.getElementById('survivorValue').textContent = e.target.value;
    });
    
    // Initialize
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    
    // Set default participants
    document.getElementById('participants').value = 'ì² ìˆ˜, ì˜í¬, ë¯¼ìˆ˜, ì§€ì˜, í˜„ìš°, ì„œì—°, ë„ìœ¤, í•˜ì€, ì‹œìš°, ì§€ì•„, ì¤€ì„œ, ìˆ˜ë¹ˆ';
  </script>
</body>
</html>

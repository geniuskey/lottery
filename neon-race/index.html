<!--
@game-meta
{
  "id": "neon-race",
  "title": "ÎÑ§Ïò® Î†àÏù¥Ïä§",
  "emoji": "üåå",
  "category": "Î†àÏù¥Ïã±",
  "description": "ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÎèÑÏãúÎ•º Í∞ÄÎ°úÏßÄÎ•¥Îäî ÌôîÎ†§Ìïú Î†àÏù¥Ïã±! ÏïÑÏù¥ÌÖúÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïó≠Ï†Ñ ÏäπÎ¶¨Î•º ÎÖ∏Î¶¨ÏÑ∏Ïöî.",
  "features": ["üéÅ ÏïÑÏù¥ÌÖú ÏãúÏä§ÌÖú", "üß≠ Ïù∏ÌÑ∞ÎûôÌã∞Î∏å ÎØ∏ÎãàÎßµ"],
  "color": "pink",
  "badge": "NEW",
  "version": "1.7.0",
  "updated": "2025-12-25",
  "author": {
    "name": "Euiyun Edwin Kim",
    "email": "geniuskey@gmail.com",
    "github": "geniuskey"
  },
  "urls": {
    "service": "https://geniuskey.github.io/lottery/neon-race/",
    "repository": "https://github.com/geniuskey/lottery"
  },
  "license": "MIT",
  "copyright": "¬© 2025 Euiyun Edwin Kim. Licensed under the MIT License."
}
@end-game-meta
-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåå ÎÑ§Ïò® Î†àÏù¥Ïä§</title>
    
    <!-- SEO Í∏∞Î≥∏ -->
    <meta name="description" content="ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÎèÑÏãúÎ•º Í∞ÄÎ°úÏßÄÎ•¥Îäî ÌôîÎ†§Ìïú Î†àÏù¥Ïã±! ÏïÑÏù¥ÌÖúÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïó≠Ï†Ñ ÏäπÎ¶¨Î•º ÎÖ∏Î¶¨ÏÑ∏Ïöî.">
    <meta name="author" content="Euiyun Edwin Kim">
    <meta name="keywords" content="ÎÑ§Ïò® Î†àÏù¥Ïä§, Ï∂îÏ≤®, Í≤åÏûÑ, lottery, Î†àÏù¥Ïã±, ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨, ÎÑ§Ïò®, ÎûúÎç§ Ï∂îÏ≤®, ÎßàÎ¶¨Ïò§Ïπ¥Ìä∏">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Ï∂îÏ≤® Í≤åÏûÑ Ìè¨ÌÉà">
    <meta property="og:title" content="üåå ÎÑ§Ïò® Î†àÏù¥Ïä§">
    <meta property="og:description" content="ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÎèÑÏãúÎ•º Í∞ÄÎ°úÏßÄÎ•¥Îäî ÌôîÎ†§Ìïú Î†àÏù¥Ïã±! ÏïÑÏù¥ÌÖúÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïó≠Ï†Ñ ÏäπÎ¶¨Î•º ÎÖ∏Î¶¨ÏÑ∏Ïöî.">
    <meta property="og:url" content="https://geniuskey.github.io/lottery/neon-race/">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="üåå ÎÑ§Ïò® Î†àÏù¥Ïä§">
    <meta name="twitter:description" content="ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÎèÑÏãúÎ•º Í∞ÄÎ°úÏßÄÎ•¥Îäî ÌôîÎ†§Ìïú Î†àÏù¥Ïã±! ÏïÑÏù¥ÌÖúÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïó≠Ï†Ñ ÏäπÎ¶¨Î•º ÎÖ∏Î¶¨ÏÑ∏Ïöî.">
    
    <!-- Ï∂îÍ∞Ä SEO -->
    <link rel="canonical" href="https://geniuskey.github.io/lottery/neon-race/">
    <meta name="robots" content="index, follow">
    
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #020617;
            --bg-card: rgba(15, 23, 42, 0.95);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-primary: #f1f5f9;
            --text-secondary: #64748b;
            --accent-pink: #ff007f;
            --accent-cyan: #00f2ff;
            --accent-purple: #bc13fe;
            --accent-gold: #ffd700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }

        .container { display: flex; height: 100vh; width: 100vw; }

        /* Sidebar */
        .sidebar {
            width: 280px; min-width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--glass-border);
            display: flex; flex-direction: column; z-index: 10;
        }

        .sidebar-header { padding: 15px; border-bottom: 1px solid var(--glass-border); flex-shrink: 0; }
        .logo-row { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Black Han Sans', sans-serif; font-size: 1.3rem; color: var(--accent-pink); text-shadow: 0 0 15px rgba(255, 0, 127, 0.4); }

        .help-btn {
            background: rgba(255, 255, 255, 0.1); border: none; color: var(--text-secondary);
            width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
        }
        .help-btn:hover { background: rgba(255, 255, 255, 0.2); color: var(--text-primary); }

        .sidebar-content { padding: 15px; flex: 1; display: flex; flex-direction: column; min-height: 0; overflow-y: auto; }
        .section { margin-bottom: 15px; flex-shrink: 0; }
        .section-title { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

        .participants-input {
            width: 100%; height: 100px; background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 8px; color: #fff; padding: 10px; font-size: 0.85rem; resize: none; font-family: inherit;
        }
        .participants-input:focus { outline: none; border-color: var(--accent-pink); }

        .slider-group { margin-bottom: 12px; }
        .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .slider-label { font-size: 0.8rem; color: var(--text-secondary); }
        .slider-value { font-size: 0.9rem; font-weight: bold; color: var(--accent-pink); }

        input[type="range"] { width: 100%; height: 4px; border-radius: 2px; background: var(--glass-border); -webkit-appearance: none; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--accent-pink); cursor: pointer; }

        .btn-group { display: flex; gap: 8px; margin-top: 15px; flex-shrink: 0; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-family: inherit; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-purple));
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 127, 0.3);
        }

        .btn-secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
        }

        .ranking-section {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            flex: 1;
            overflow-y: auto;
            min-height: 150px;
            display: flex;
            flex-direction: column;
        }
        .ranking-item { display: flex; align-items: center; padding: 8px; border-radius: 6px; margin-bottom: 4px; background: rgba(255, 255, 255, 0.02); font-size: 0.8rem; transition: all 0.3s; }
        .ranking-rank { width: 24px; font-weight: bold; color: var(--accent-cyan); }
        .ranking-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .ranking-time { font-size: 0.7rem; font-family: monospace; color: var(--text-secondary); margin-left: 8px; }
        .ranking-item-icon { margin-left: 8px; font-size: 1rem; }

        .sidebar-footer { padding: 15px; border-top: 1px solid var(--glass-border); display: flex; justify-content: center; gap: 10px; flex-shrink: 0; }
        .icon-btn { width: 36px; height: 36px; border-radius: 8px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-secondary); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .icon-btn:hover { background: rgba(255, 255, 255, 0.1); color: var(--text-primary); transform: translateY(-2px); }

        [data-tooltip] { position: relative; }
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            font-size: 0.7rem;
            border-radius: 4px;
            white-space: nowrap;
            margin-bottom: 5px;
        }

        .game-area { flex: 1; position: relative; background: #000; overflow: hidden; }
        #gameCanvas { width: 100%; height: 100%; display: block; cursor: crosshair; }

        .game-timer {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Black Han Sans', sans-serif;
            font-size: 1.8rem;
            color: var(--accent-pink);
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 20px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            z-index: 5;
            pointer-events: none;
        }

        .copyright { position: absolute; bottom: 10px; right: 15px; font-size: 0.7rem; color: rgba(255, 255, 255, 0.25); pointer-events: none; user-select: none; }

        .winner-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.92); backdrop-filter: blur(10px);
            display: none; flex-direction: column; align-items: center; justify-content: flex-start; 
            padding: 40px 20px; z-index: 1000; overflow-y: auto;
        }
        .winner-overlay.show { display: flex; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .result-header { text-align: center; margin-bottom: 20px; }
        .winner-label { font-size: 1.2rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 4px; margin-bottom: 10px; }

        .winner-title { 
            font-family: 'Black Han Sans', sans-serif; 
            font-size: 4rem; 
            color: var(--accent-pink); 
            margin-bottom: 5px; 
            text-shadow: 0 0 30px var(--accent-pink);
            animation: championGlow 2s infinite alternate, championPop 0.5s ease-out;
        }
        @keyframes championGlow {
            0% { text-shadow: 0 0 20px var(--accent-pink), 0 0 40px var(--accent-cyan); color: #fff; }
            100% { text-shadow: 0 0 50px var(--accent-purple), 0 0 80px var(--accent-pink); color: var(--accent-pink); }
        }
        @keyframes championPop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .winner-name { 
            font-size: 2.8rem; 
            color: #fff; 
            margin-bottom: 30px; 
            animation: namePulse 1.5s infinite ease-in-out;
        }
        @keyframes namePulse {
            0%, 100% { transform: scale(1); text-shadow: 0 0 10px #fff; }
            50% { transform: scale(1.05); text-shadow: 0 0 30px var(--accent-gold); color: var(--accent-gold); }
        }

        .final-rankings {
            width: 100%; max-width: 480px;
            max-height: 45vh;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px;
            margin-bottom: 30px;
        }
        .final-rankings::-webkit-scrollbar { width: 6px; }
        .final-rankings::-webkit-scrollbar-track { background: transparent; }
        .final-rankings::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 10px; }
        .final-rankings::-webkit-scrollbar-thumb:hover { background: var(--accent-pink); }
        .final-rankings-title { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; text-align: center; }
        
        .final-ranking-item {
            display: flex; align-items: center; gap: 15px;
            padding: 12px 16px; border-radius: 12px; margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.02);
            animation: resultSlideIn 0.4s ease forwards; opacity: 0;
        }
        @keyframes resultSlideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .final-ranking-item.rank-1 { background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), transparent); border: 1px solid rgba(255, 215, 0, 0.3); }
        .final-ranking-item.rank-2 { background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), transparent); border: 1px solid rgba(192, 192, 192, 0.2); }
        .final-ranking-item.rank-3 { background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), transparent); border: 1px solid rgba(205, 127, 50, 0.2); }

        .final-position { 
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; 
            background: rgba(255, 255, 255, 0.1); border-radius: 50%; font-weight: 700; font-size: 0.9rem;
        }
        .rank-1 .final-position { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .rank-2 .final-position { background: linear-gradient(135deg, #e0e0e0, #a0a0a0); color: #000; }
        .rank-3 .final-position { background: linear-gradient(135deg, #cd7f32, #8b4513); color: #fff; }

        .final-name { flex: 1; font-weight: 600; font-size: 1.1rem; }
        .final-time { font-size: 0.85rem; color: var(--text-secondary); font-family: monospace; }

        .result-buttons { display: flex; gap: 12px; justify-content: center; width: 100%; max-width: 480px; }
        .winner-btn { flex: 1; padding: 15px; font-size: 1.1rem; border-radius: 12px; height: auto; }

        /* Confetti */
        .confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; animation: confettiFall 3s ease-in-out forwards; }
        @keyframes confettiFall {
            0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; min-width: unset; max-height: 45vh; border-right: none; border-bottom: 1px solid var(--glass-border); }
            .game-area { flex: 1; min-height: 55vh; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-pink); }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-row">
                    <span class="logo">üåå ÎÑ§Ïò® Î†àÏù¥Ïä§</span>
                    <button class="help-btn" id="helpBtn">?</button>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="section">
                    <div class="section-title">Ï∞∏Ïó¨Ïûê Î™ÖÎã®</div>
                    <textarea class="participants-input" id="participants" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ï§ÑÎ∞îÍøà ÎòêÎäî ÏâºÌëú)\nÏòà: Ï≤†Ïàò, ÏòÅÌù¨*3, ÎØºÏàò">ÏòÅÏàò, ÏòÅÌò∏, ÏòÅÏãù, ÏòÅÏ≤†, Í¥ëÏàò, ÏÉÅÏ≤†</textarea>
                </div>

                <div class="section">
                    <div class="section-title">‚öôÔ∏è Í≤åÏûÑ ÏÑ§Ï†ï</div>
                    <div class="settings-card" style="background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:12px; padding:12px;">
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label">Ìä∏Îûô Í∏∏Ïù¥</span>
                                <span class="slider-value" id="lengthValue">10000</span>
                            </div>
                            <input type="range" id="raceLengthSlider" min="3000" max="30000" step="500" value="10000">
                        </div>
                        
                        <div class="slider-group" style="margin-bottom:0;">
                            <div class="slider-header">
                                <span class="slider-label">Ïû•Ïï†Î¨º Î∞ÄÎèÑ</span>
                                <span class="slider-value" id="densityValue">ÎßéÏùå</span>
                            </div>
                            <input type="range" id="densitySlider" min="20" max="100" step="10" value="60">
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="btn-group">
                        <button class="btn btn-primary" id="startBtn" style="flex: 2;">üéÆ ÏãúÏûë</button>
                        <button class="btn btn-secondary" id="resetBtn" style="flex: 1;">‚Ü∫</button>
                        <button class="btn btn-secondary" id="finishBtn" style="flex: 1; background:rgba(239,68,68,0.1); border-color:rgba(239,68,68,0.3); color:#ff4444;">Ï¢ÖÎ£å</button>
                    </div>
                </div>
                <div class="section" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                    <div class="ranking-section">
                        <div class="section-title">üìä Ïã§ÏãúÍ∞Ñ ÌòÑÌô©</div>
                        <div id="rankingList">
                            <div style="text-align:center; padding:20px; color:var(--text-secondary); font-size:0.8rem;">ÎåÄÍ∏∞ Ï§ë...</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-footer">
                <a href="https://geniuskey.github.io/lottery/" class="icon-btn" data-tooltip="Ï∂îÏ≤® Ìè¨ÌÉà Ìôà">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                </a>
                <button class="icon-btn" id="copyResultBtn" data-tooltip="Í≤∞Í≥º Î≥µÏÇ¨">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
                <a href="https://github.com/geniuskey/lottery" target="_blank" class="icon-btn" data-tooltip="GitHub Ï†ÄÏû•ÏÜå">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>
                </a>
                <a href="https://buymeacoffee.com/euiyun" target="_blank" class="icon-btn" data-tooltip="Ïª§Ìîº ÏÇ¨Ï£ºÍ∏∞ ‚òï">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.232-.215.03-.437.03-.653.03h-.002c-.215 0-.438 0-.653-.03-.215-.032-.433-.095-.578-.232-.145-.138-.21-.364-.243-.579-.034-.215-.034-.438-.034-.653v-.002c0-.215 0-.438.034-.653.034-.215.1-.441-.243-.579.145-.138.363-.201.578-.232.215-.03.438-.03.653-.03.215 0 .438 0 .653.03.215.032.433.095.578.232.145.138.21.364.243.579.034.215.034.438.034.653v.002c0 .215 0 .438-.034.653-.034.215-.1.441-.243.579z"></path></svg>
                </a>
            </div>
        </aside>
        <main class="game-area">
            <div class="game-timer" id="gameTimer">00:00.00</div>
            <canvas id="gameCanvas"></canvas>
            <div class="copyright">¬© 2025 Euiyun Edwin Kim.</div>
        </main>
    </div>

    <div class="winner-overlay" id="winnerOverlay">
        <div class="confetti-container" id="confettiContainer"></div>
        <div class="result-header">
            <div class="winner-label">üèÜ CHAMPION</div>
            <div class="winner-title" id="winnerTitle">NEON RACE</div>
            <div class="winner-name" id="winnerName">-</div>
        </div>
        <div class="final-rankings">
            <div class="final-rankings-title">üèÅ ÏµúÏ¢Ö ÏàúÏúÑ</div>
            <div id="finalRankingList"></div>
        </div>
        <div class="result-buttons">
            <button class="btn btn-secondary winner-btn" id="copyResultOverlayBtn">üìã Í≤∞Í≥º Î≥µÏÇ¨</button>
            <button class="btn btn-primary winner-btn" id="restartBtn">ÌôïÏù∏</button>
        </div>
    </div>

    <canvas id="celebCanvas" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1100; pointer-events:none;"></canvas>

    <script>
        class NeonRace {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.celebCanvas = document.getElementById('celebCanvas');
                this.celebCtx = this.celebCanvas.getContext('2d');
                
                this.isRunning = false;
                this.isCelebrating = false; // Ï∂ïÌïò ÏÉÅÌÉú ÌîåÎûòÍ∑∏
                this.players = [];
                this.obstacles = [];
                this.itemBoxes = [];
                this.particles = [];
                this.cameraX = 0;
                this.raceLength = 10000;
                this.obstacleDensity = 60;
                this.lastUpdate = 0;
                this.gameStartTime = 0;
                this.shake = 0;
                
                // ÎØ∏ÎãàÎßµ Í¥ÄÎ†®
                this.isDraggingMinimap = false;
                this.isAutoTracking = true;
                this.minimapRect = { x: 0, y: 0, w: 0, h: 40 };
                this.lastResultText = ""; // ÎßàÏßÄÎßâ Í≤∞Í≥º Ï†ÄÏû•Ïö©

                this.emojis = [
                    'üòÄ','üòÉ','üòÑ','üòÅ','üòÜ','üòÖ','üòÇ','ü§£','üòâ','üòä','üòá','üòç','ü§©','üòò','üòó','üòö','üòã','üòõ','üòú','ü§™','üòù','ü§ë','ü§ó','ü§≠','ü§´','ü§î',
                    'üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº','üêª‚Äç‚ùÑÔ∏è','üê®','üêØ','ü¶Å','üêÆ','üê∑','üêµ','üêî','üêß','üê¶','üê§','üê£','ü¶â','üê∫'
                ];
                this.colors = ['#ff007f', '#00f2ff', '#bc13fe', '#ffdd00', '#39ff14', '#ff4d00'];
                this.items = [
                    { id: 'nitro', icon: 'üöÄ', chance: 0.4 },
                    { id: 'shield', icon: 'üõ°Ô∏è', chance: 0.3 },
                    { id: 'ghost', icon: 'üëª', chance: 0.2 },
                    { id: 'lightning', icon: 'üå©Ô∏è', chance: 0.1 }
                ];
                
                this.setupCanvas();
                this.bindEvents();
            }

            setupCanvas() {
                const wrapper = this.canvas.parentElement;
                this.canvas.width = wrapper.clientWidth;
                this.canvas.height = wrapper.clientHeight;
                
                // Ï∂ïÌïòÏö© Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ (Ï†ÑÏ≤¥ ÌôîÎ©¥)
                this.celebCanvas.width = window.innerWidth;
                this.celebCanvas.height = window.innerHeight;
                
                const padding = 50;
                this.minimapRect = {
                    x: padding, y: this.canvas.height - 60,
                    w: this.canvas.width - padding * 2, h: 40
                };
            }

            bindEvents() {
                window.addEventListener('resize', () => { this.setupCanvas(); this.draw(); });
                const handlePointer = (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    if (y >= this.minimapRect.y && y <= this.minimapRect.y + this.minimapRect.h &&
                        x >= this.minimapRect.x && x <= this.minimapRect.x + this.minimapRect.w) {
                        this.isDraggingMinimap = true;
                        this.isAutoTracking = false;
                        const pct = (x - this.minimapRect.x) / this.minimapRect.w;
                        this.cameraX = pct * this.raceLength - this.canvas.width / 2;
                        this.clampCamera();
                        this.draw();
                    }
                };
                this.canvas.addEventListener('pointerdown', handlePointer);
                this.canvas.addEventListener('pointermove', (e) => { if (this.isDraggingMinimap) handlePointer(e); });
                window.addEventListener('pointerup', () => { this.isDraggingMinimap = false; });
            }

            clampCamera() {
                const maxCamX = this.raceLength - this.canvas.width * 0.85;
                this.cameraX = Math.max(0, Math.min(this.cameraX, maxCamX));
            }

            prepare(names, raceLength, density, shouldShuffle = false) {
                this.isRunning = false; // Í≤åÏûÑ Ï§ëÎã® ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï
                this.isCelebrating = false; // Ï∂ïÌïò Ïï†ÎãàÎ©îÏù¥ÏÖò Ï§ëÎã®
                this.raceLength = raceLength;
                this.obstacleDensity = density;
                const laneHeight = (this.canvas.height - 100) / (names.length + 1);
                
                // ÏàúÏÑú ÏÖîÌîå Î°úÏßÅ
                const displayNames = shouldShuffle ? [...names].sort(() => Math.random() - 0.5) : names;

                this.players = displayNames.map((name, i) => ({
                    name, 
                    emoji: this.emojis[Math.floor(Math.random() * this.emojis.length)],
                    color: this.colors[i % this.colors.length],
                    x: 100, y: laneHeight * (i + 1) + 20,
                    baseY: laneHeight * (i + 1) + 20,
                    vx: 0, vy: 0,
                    speed: 4 + Math.random() * 3,
                    accel: 0.15 + Math.random() * 0.15,
                    trail: [], finished: false, finishTime: 0, rank: 0,
                    collisionTimer: 0, item: null, itemTimer: 0,
                    isGhost: false, hasShield: false
                }));

                this.obstacles = [];
                const obstacleCount = Math.floor(density * (raceLength / 6000) * 0.8);
                const yBucketSize = (this.canvas.height - 120) / obstacleCount;
                for (let i = 0; i < obstacleCount; i++) {
                    this.obstacles.push({
                        x: 800 + Math.random() * (this.raceLength - 1500),
                        y: 40 + (i * yBucketSize) + Math.random() * yBucketSize,
                        type: Math.random() > 0.6 ? 'boost' : 'slow',
                        size: 50 + Math.random() * 30,
                        angle: Math.random() * Math.PI * 2,
                        rotSpeed: (0.02 + Math.random() * 0.05) * (Math.random() > 0.5 ? 1 : -1)
                    });
                }

                this.itemBoxes = [];
                const boxCount = Math.floor(raceLength / 1200);
                for (let i = 0; i < boxCount; i++) {
                    this.itemBoxes.push({
                        x: 1500 + (i * 1200) + (Math.random() * 400),
                        y: Math.random() * (this.canvas.height - 120) + 40,
                        size: 40, angle: 0, active: true
                    });
                }

                this.particles = [];
                const confettiContainer = document.getElementById('confettiContainer');
                if (confettiContainer) confettiContainer.innerHTML = '';
                
                this.cameraX = 0;
                this.isAutoTracking = true;
                this.shake = 0;
                this.gameStartTime = 0;
                document.getElementById('gameTimer').textContent = '00:00.00';
                this.draw();
            }

            start() {
                if (this.players.length === 0) return;
                this.isRunning = true;
                this.gameStartTime = performance.now();
                this.lastUpdate = performance.now();
                requestAnimationFrame((ts) => this.animate(ts));
            }

            addParticles(x, y, color, count = 10) {
                // ÏÑ±Îä• ÏµúÏ†ÅÌôî: ÏµúÎåÄ ÌååÌã∞ÌÅ¥ Ïàò Ï†úÌïú
                if (this.particles.length > 400) return;
                
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x, y, vx: (Math.random() - 0.5) * 15, vy: (Math.random() - 0.5) * 15,
                        life: 1.0, size: Math.random() * 4 + 2, color
                    });
                }
            }

            useItem(p) {
                if (!p.item) return;
                const item = p.item;
                p.item = null;
                if (item.id === 'nitro') { p.vx += 30; this.addParticles(p.x, p.y, p.color, 20); }
                else if (item.id === 'shield') { p.hasShield = true; p.itemTimer = 180; }
                else if (item.id === 'ghost') { p.isGhost = true; p.itemTimer = 120; p.vx += 15; }
                else if (item.id === 'lightning') {
                    this.shake = 15;
                    this.players.forEach(other => {
                        if (other !== p && !other.hasShield) { other.vx -= 15; this.addParticles(other.x, other.y, '#ffd700', 10); }
                    });
                }
                this.updateRankingUI();
            }

            forceFinish() {
                if (!this.isRunning) return;
                const now = performance.now();
                const remaining = this.players.filter(p => !p.finished);
                // Í±∞Î¶¨ÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÏó¨ ÏôÑÏ£º Ï≤òÎ¶¨
                remaining.sort((a, b) => b.x - a.x);
                remaining.forEach((p, i) => {
                    p.finished = true;
                    p.trail = [];
                    p.finishTime = now + i; // ÏïÑÏ£º ÏûëÏùÄ Ï∞®Ïù¥Î•º ÎëêÏñ¥ ÏàúÏúÑ Ïú†ÏßÄ
                });
                this.updateRankingUI();
                this.endGame();
            }

            update(dt) {
                const dtScale = dt * 60;
                this.shake *= 0.9;

                // ÌååÌã∞ÌÅ¥ ÏóÖÎç∞Ïù¥Ìä∏ (Í≤åÏûÑ Ï§ëÎã® Ï§ëÏóêÎèÑ Ïã§ÌñâÎêòÏñ¥Ïïº Ìè≠Ï£ΩÏù¥ Î≥¥ÏûÑ)
                this.particles.forEach(part => { 
                    part.x += part.vx; 
                    part.y += part.vy; 
                    part.life -= 0.02; 
                });
                this.particles = this.particles.filter(part => part.life > 0);

                if (!this.isRunning) return;

                const elapsed = (performance.now() - this.gameStartTime) / 1000;
                const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const s = Math.floor(elapsed % 60).toString().padStart(2, '0');
                const ms = Math.floor((elapsed % 1) * 100).toString().padStart(2, '0');
                document.getElementById('gameTimer').textContent = `${m}:${s}.${ms}`;

                this.obstacles.forEach(obs => { obs.angle += obs.rotSpeed * dtScale; });
                this.itemBoxes.forEach(box => { box.angle += 0.05 * dtScale; });

                this.players.forEach(p => {
                    if (p.finished) {
                        const friction = Math.pow(0.9, dtScale);
                        p.vx *= friction; p.vy *= friction;
                        p.x += p.vx * dtScale; p.y += p.vy * dtScale;
                        const stopLimit = this.raceLength + 100;
                        if (p.x > stopLimit) p.x = stopLimit;
                        return;
                    }

                    if (p.itemTimer > 0) { p.itemTimer -= dtScale; if (p.itemTimer <= 0) { p.isGhost = false; p.hasShield = false; } }
                    if (p.item && Math.random() < 0.01) this.useItem(p);

                    // --- Ïó≠Ï†Ñ ÎìúÎùºÎßàÎ•º ÏúÑÌïú ÎèôÏ†Å Î¨ºÎ¶¨ Î°úÏßÅ ---
                    // ÌòÑÏû¨ ÏàúÏúÑ Í≥ÑÏÇ∞ (Î¨ºÎ¶¨Ïö©)
                    const sortedForPhysics = [...this.players].sort((a, b) => b.x - a.x);
                    const myRank = sortedForPhysics.indexOf(p) + 1;
                    const totalPlayers = this.players.length;

                    // 1. ÌõÑÎØ∏ Í∑∏Î£π Ï∂îÍ≤© Í∞ÄÏÜç (Catch-up)
                    // Îí§Ïóê ÏûàÏùÑÏàòÎ°ù Í∞ÄÏÜçÎèÑ Î≥¥ÎÑàÏä§ Î∂ÄÏó¨ (ÏµúÎåÄ 1.5Î∞∞)
                    const catchUpBonus = 1 + ((myRank - 1) / totalPlayers) * 0.5;
                    
                    // 2. ÏÑ†Îëê Í≥µÍ∏∞ Ï†ÄÌï≠ (Air Resistance)
                    // 1Îì±Ïù¥ 2Îì±Í≥º Í±∞Î¶¨Í∞Ä 800px Ïù¥ÏÉÅ Î≤åÏñ¥ÏßÄÎ©¥ ÏÜçÎèÑ ÎØ∏ÏÑ∏ Í∞êÏÜç
                    let resistance = 1.0;
                    if (myRank === 1 && totalPlayers > 1) {
                        const distToSecond = p.x - sortedForPhysics[1].x;
                        if (distToSecond > 800) resistance = 0.985;
                    }

                    p.vy *= Math.pow(0.92, dtScale);
                    p.vx += p.accel * dtScale * catchUpBonus;
                    p.vx *= Math.pow(0.97, dtScale) * resistance;
                    p.x += (p.speed + p.vx) * dtScale;
                    p.y += p.vy * dtScale;
                    // ---------------------------------------

                    // ÌÉÑÏÑ± ÎÜíÏùÄ ÎÖ∏ÎûÄ Bar Ï∂©Îèå (ÏÉÅÌïò)
                    const barH = 8;
                    const bounceMargin = 15; // Ï∫êÎ¶≠ÌÑ∞ Î∞òÍ≤Ω ÎåÄÎûµÍ∞í
                    if (p.y < barH + bounceMargin) { 
                        p.y = barH + bounceMargin; 
                        p.vy = Math.abs(p.vy) + 15; // ÌÉï! ÌïòÍ≥† ÌäïÍπÄ
                        this.shake = 5;
                        this.addParticles(p.x, p.y, '#ffd700', 5);
                    }
                    if (p.y > this.canvas.height - 80 - barH - bounceMargin) { 
                        p.y = this.canvas.height - 80 - barH - bounceMargin; 
                        p.vy = -(Math.abs(p.vy) + 15); // ÌÉï! ÌïòÍ≥† ÌäïÍπÄ
                        this.shake = 5;
                        this.addParticles(p.x, p.y, '#ffd700', 5);
                    }

                    if (p.collisionTimer > 0) p.collisionTimer -= dtScale;
                    if (!p.isGhost) {
                        p.trail.push({x: p.x, y: p.y});
                        if (p.trail.length > 25) p.trail.shift();
                    }

                    this.itemBoxes.forEach(box => {
                        if (box.active && Math.abs(p.x - box.x) < 40 && Math.abs(p.y - box.y) < 40) {
                            box.active = false;
                            if (!p.item) {
                                // ÏàúÏúÑÏóê Îî∞Î•∏ Ï∞®Îì± ÏïÑÏù¥ÌÖú ÌöçÎìù Î°úÏßÅ
                                const sortedForItems = [...this.players].sort((a, b) => b.x - a.x);
                                const rank = sortedForItems.indexOf(p) + 1;
                                const total = this.players.length;
                                
                                let itemPool = [];
                                if (rank === 1) {
                                    // 1Îì±: Ï£ºÎ°ú Ïâ¥Îìú, Í∞ÄÎÅî Î∂ÄÏä§Ìä∏
                                    itemPool = ['shield', 'shield', 'shield', 'nitro'];
                                } else if (rank <= total / 2) {
                                    // Ï§ëÏúÑÍ∂å: Í≥®Í≥†Î£®
                                    itemPool = ['nitro', 'nitro', 'shield', 'ghost', 'lightning'];
                                } else {
                                    // ÌïòÏúÑÍ∂å: Í∞ïÎ†•Ìïú Ïó≠Ï†Ñ ÏïÑÏù¥ÌÖú (ÎãàÌä∏Î°ú, Î≤àÍ∞ú)
                                    itemPool = ['nitro', 'nitro', 'nitro', 'lightning', 'lightning', 'ghost'];
                                }
                                
                                const selectedId = itemPool[Math.floor(Math.random() * itemPool.length)];
                                p.item = this.items.find(it => it.id === selectedId);
                                this.updateRankingUI();
                            }
                        }
                    });

                    this.obstacles.forEach(obs => {
                        const dx = p.x - obs.x; const dy = p.y - obs.y; const dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < obs.size / 2 && p.collisionTimer <= 0 && !p.isGhost) {
                            const nx = dx / dist; const ny = dy / dist; const tx = -ny; const ty = nx;
                            const surfaceSpeed = (obs.size / 2) * obs.rotSpeed * 15;
                            if (obs.type === 'boost') { p.vx += nx * 15 + tx * surfaceSpeed; p.vy += ny * 15 + ty * surfaceSpeed; this.shake = 10; this.addParticles(p.x, p.y, '#00f2ff', 8); }
                            else if (!p.hasShield) {
                                p.vx = nx * 5 + tx * surfaceSpeed * 0.5;
                                const vDir = Math.abs(ny) < 0.1 ? (Math.random() > 0.5 ? 1 : -1) : Math.sign(ny);
                                p.vy = vDir * Math.max(Math.abs(ny * 25), 18) + ty * surfaceSpeed;
                                this.addParticles(p.x, p.y, '#ff4444', 5);
                            }
                            p.collisionTimer = 15;
                        }
                    });

                    if (p.x >= this.raceLength) {
                        p.finished = true; p.trail = []; p.finishTime = performance.now();
                        p.rank = this.players.filter(pl => pl.finished).length;
                        this.addParticles(p.x, p.y, p.color, 30);
                        this.updateRankingUI();
                    }
                });

                if (this.isAutoTracking && !this.isDraggingMinimap) {
                    const activePlayers = this.players.filter(p => !p.finished);
                    if (activePlayers.length > 0) {
                        const maxX = Math.max(...activePlayers.map(p => p.x));
                        let targetCameraX = Math.max(0, maxX - this.canvas.width * 0.35);
                        this.cameraX += (targetCameraX - this.cameraX) * 0.1;
                        this.clampCamera();
                    }
                }

                // Îß§ ÌîÑÎ†àÏûÑ Îû≠ÌÇπ UI ÏóÖÎç∞Ïù¥Ìä∏ (ÏßÑÌñâ % Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ)
                this.updateRankingUI();

                if (this.players.every(p => p.finished)) { setTimeout(() => this.endGame(), 2500); }
            }

            updateRankingUI() {
                const finished = this.players.filter(p => p.finished).sort((a, b) => a.finishTime - b.finishTime);
                const racing = this.players.filter(p => !p.finished).sort((a, b) => b.x - a.x);
                
                const list = document.getElementById('rankingList');
                let html = "";

                const getMedal = (rank) => {
                    if (rank === 1) return "ü•á ";
                    if (rank === 2) return "ü•à ";
                    if (rank === 3) return "ü•â ";
                    return "";
                };

                // ÏôÑÏ£ºÏûê Î™©Î°ù
                finished.forEach((p, i) => {
                    const rank = i + 1;
                    const time = (p.finishTime - this.gameStartTime) / 1000;
                    html += `
                        <div class="ranking-item" style="border-left: 3px solid ${p.color}">
                            <span class="ranking-rank">${rank}</span>
                            <span class="ranking-name">${p.emoji} ${p.name} ${p.item ? `<span class="ranking-item-icon">${p.item.icon}</span>` : ''}</span>
                            <span class="ranking-time">${getMedal(rank)}${time.toFixed(2)}s</span>
                        </div>
                    `;
                });

                // Íµ¨Î∂ÑÏÑ† (Î†àÏù¥Ïã± Ï§ëÏù∏ ÏÇ¨ÎûåÏù¥ ÏûàÏùÑ ÎïåÎßå)
                if (racing.length > 0) {
                    if (finished.length > 0) {
                        html += `<div style="text-align:center; font-size:0.65rem; color:var(--text-secondary); margin: 10px 0; letter-spacing:1px;">‚Äî Î†àÏù¥Ïã± Ï§ë ‚Äî</div>`;
                    }
                    
                    racing.forEach((p, i) => {
                        const rank = finished.length + i + 1;
                        const progress = Math.floor((p.x / this.raceLength) * 100);
                        html += `
                            <div class="ranking-item" style="border-left: 3px solid ${p.color}; opacity: 0.85;">
                                <span class="ranking-rank">${rank}</span>
                                <span class="ranking-name">${p.emoji} ${p.name} ${p.item ? `<span class="ranking-item-icon">${p.item.icon}</span>` : ''}</span>
                                <span class="ranking-time">${progress}%</span>
                            </div>
                        `;
                    });
                }

                list.innerHTML = html || `<div style="text-align:center; padding:20px; color:var(--text-secondary); font-size:0.8rem;">ÎåÄÍ∏∞ Ï§ë...</div>`;
            }

            createConfetti() {
                const container = document.getElementById('confettiContainer');
                const colors = ['#ff007f', '#00f2ff', '#bc13fe', '#ffd700', '#39ff14'];
                // ÏÑ±Îä• ÏµúÏ†ÅÌôî: Ïª®ÌéòÌã∞ Ïàò Í∞êÏÜå (100 -> 50)
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 8 + 5 + 'px';
                    confetti.style.height = confetti.style.width;
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
                    container.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }
            }

            endGame() {
                if (!this.isRunning) return;
                this.isRunning = false;
                this.isCelebrating = true; 
                
                const sorted = [...this.players].sort((a, b) => {
                    if (a.finished && b.finished) return a.finishTime - b.finishTime;
                    if (a.finished) return -1;
                    if (b.finished) return 1;
                    return b.x - a.x;
                });
                
                const winner = sorted[0];
                document.getElementById('winnerName').textContent = `${winner.emoji} ${winner.name}`;
                
                // ÏµúÏ¢Ö ÏàúÏúÑ Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±
                const finalRankingList = document.getElementById('finalRankingList');
                finalRankingList.innerHTML = sorted.map((p, i) => {
                    const rank = i + 1;
                    const medal = (rank === 1) ? "ü•á " : (rank === 2) ? "ü•à " : (rank === 3) ? "ü•â " : "";
                    const timeText = p.finished ? `${medal}${((p.finishTime - this.gameStartTime) / 1000).toFixed(2)}s` : `${Math.floor((p.x / this.raceLength) * 100)}%`;
                    return `
                        <div class="final-ranking-item rank-${rank}" style="animation-delay: ${i * 0.1}s">
                            <span class="final-position">${rank}</span>
                            <span class="final-name">${p.emoji} ${p.name}</span>
                            <span class="final-time">${timeText}</span>
                        </div>
                    `;
                }).join('');

                document.getElementById('winnerOverlay').classList.add('show');
                document.getElementById('confettiContainer').innerHTML = '';
                this.createConfetti();
                
                // ÎßàÏßÄÎßâ Í≤∞Í≥º ÌÖçÏä§Ìä∏ Ï†ÄÏû•
                this.lastResultText = this.getResultText();

                // Ï∂ïÌïò Ìè≠Ï£Ω Ïó∞Ï∂ú (ÏÑ±Îä• ÏµúÏ†ÅÌôî Î≤ÑÏ†Ñ)
                let count = 0;
                const winEmojis = ['üèÜ', '‚ú®', 'üéâ', 'üåü', 'üëë'];
                const firework = () => {
                    if (!this.isCelebrating || count > 12) { 
                        this.isCelebrating = false; 
                        return;
                    }
                    const x = Math.random() * this.celebCanvas.width;
                    const y = Math.random() * this.celebCanvas.height;
                    const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                    
                    this.addParticles(x, y, color, 25); // ÌååÌã∞ÌÅ¥ Ïàò Í∞êÏÜå (50 -> 25)
                    
                    for(let i=0; i<3; i++) { // Ïù¥Î™®ÏßÄ Ïàò Í∞êÏÜå (5 -> 3)
                        this.particles.push({
                            x, y, 
                            vx: (Math.random() - 0.5) * 15, 
                            vy: (Math.random() - 0.5) * 15,
                            life: 1.2, 
                            size: 20, 
                            color: '#fff',
                            text: winEmojis[Math.floor(Math.random() * winEmojis.length)]
                        });
                    }

                    this.shake = 10; // ÌùîÎì§Î¶º Í∞ïÎèÑ ÏôÑÌôî
                    count++;
                    setTimeout(firework, 400 + Math.random() * 400); // Í∞ÑÍ≤© Ï¶ùÍ∞Ä
                };
                firework();
            }

            draw() {
                const ctx = this.ctx; const w = this.canvas.width; const h = this.canvas.height;
                const cctx = this.celebCtx;
                
                // Î©îÏù∏ Í≤åÏûÑ Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
                ctx.fillStyle = '#020617'; ctx.fillRect(0, 0, w, h);
                
                // Ï∂ïÌïòÏö© Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
                cctx.clearRect(0, 0, this.celebCanvas.width, this.celebCanvas.height);

                ctx.save();
                if (this.shake > 0.1) ctx.translate((Math.random()-0.5)*this.shake, (Math.random()-0.5)*this.shake);
                
                // Í≤åÏûÑ ÏöîÏÜåÎäî Ïπ¥Î©îÎùº Ï¢åÌëúÍ≥Ñ ÏÇ¨Ïö©
                ctx.save();
                ctx.translate(-this.cameraX, 0);
                
                // ÏÉÅÌïò ÌÉÑÏÑ± Bar Í∑∏Î¶¨Í∏∞
                ctx.fillStyle = '#ffd700';
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ffd700';
                ctx.fillRect(this.cameraX, 0, this.canvas.width, 8);
                ctx.fillRect(this.cameraX, h - 88, this.canvas.width, 8);
                ctx.shadowBlur = 0;

                // Í∞ÄÏù¥Îìú ÎùºÏù∏
                ctx.strokeStyle = 'rgba(0, 242, 255, 0.05)';
                ctx.lineWidth = 1;
                for (let i = 0; i < this.raceLength + 2000; i += 200) {
                    ctx.beginPath(); ctx.moveTo(i, 8); ctx.lineTo(i, h - 88); ctx.stroke();
                }
                this.obstacles.forEach(obs => {
                    const isBoost = obs.type === 'boost';
                    ctx.save(); ctx.translate(obs.x, obs.y); ctx.rotate(obs.angle);
                    ctx.shadowBlur = 20; ctx.shadowColor = isBoost ? '#00f2ff' : '#ff0055';
                    ctx.fillStyle = isBoost ? 'rgba(0, 242, 255, 0.2)' : 'rgba(255, 0, 85, 0.2)';
                    ctx.strokeStyle = isBoost ? '#00f2ff' : '#ff0055'; ctx.lineWidth = 2;
                    ctx.beginPath();
                    for(let i=0; i<6; i++) {
                        const ang = (i/6) * Math.PI * 2;
                        const px = Math.cos(ang) * (obs.size/2); const py = Math.sin(ang) * (obs.size/2);
                        if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
                    }
                    ctx.closePath(); ctx.fill(); ctx.stroke(); ctx.restore();
                });
                this.itemBoxes.forEach(box => {
                    if (!box.active) return;
                    ctx.save(); ctx.translate(box.x, box.y); ctx.rotate(box.angle);
                    ctx.shadowBlur = 15; ctx.shadowColor = '#fff';
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.2)'; ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2; ctx.strokeRect(-box.size/2, -box.size/2, box.size, box.size);
                    ctx.font = '24px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText('üéÅ', 0, 0); ctx.restore();
                });
                const finishX = this.raceLength;
                const grad = ctx.createLinearGradient(finishX - 50, 0, finishX + 50, 0);
                grad.addColorStop(0, 'transparent'); grad.addColorStop(0.5, '#ff007f'); grad.addColorStop(1, 'transparent');
                ctx.fillStyle = grad; ctx.fillRect(finishX - 50, 8, 100, h - 96);
                this.players.forEach(p => {
                    if (p.trail.length > 1) {
                        ctx.save(); ctx.shadowBlur = 15; ctx.shadowColor = p.color; ctx.strokeStyle = p.color; ctx.lineWidth = 4; ctx.lineCap = 'round';
                        ctx.beginPath(); ctx.moveTo(p.trail[0].x, p.trail[0].y);
                        p.trail.forEach((t, idx) => { ctx.globalAlpha = idx / p.trail.length; ctx.lineTo(t.x, t.y); });
                        ctx.stroke(); ctx.restore();
                    }
                    ctx.save(); ctx.translate(p.x, p.y);
                    if (p.isGhost) ctx.globalAlpha = 0.4;
                    if (p.hasShield) { ctx.strokeStyle = '#00f2ff'; ctx.lineWidth = 3; ctx.beginPath(); ctx.arc(0, 0, 30, 0, Math.PI*2); ctx.stroke(); }
                    ctx.font = '36px serif'; ctx.textAlign = 'center'; ctx.shadowBlur = 10; ctx.shadowColor = '#fff';
                    ctx.fillText(p.emoji, 0, 12); ctx.restore();
                    ctx.font = 'bold 13px "Noto Sans KR"'; ctx.fillStyle = '#fff'; ctx.strokeStyle = '#000'; ctx.lineWidth = 3;
                    ctx.strokeText(p.name, p.x, p.y - 30); ctx.fillText(p.name, p.x, p.y - 30);
                });
                ctx.restore(); // camera translate restore

                // ÌååÌã∞ÌÅ¥ÏùÄ celebCanvasÏóê Í∑∏Î¶¨Í∏∞ (ÌôîÎ©¥ Ï¢åÌëúÍ≥Ñ ÏÇ¨Ïö©)
                this.particles.forEach(part => { 
                    cctx.globalAlpha = part.life; 
                    if (part.text) {
                        cctx.font = `${part.size}px serif`;
                        cctx.textAlign = 'center';
                        cctx.textBaseline = 'middle';
                        cctx.fillText(part.text, part.x, part.y);
                    } else {
                        cctx.fillStyle = part.color; 
                        cctx.fillRect(part.x, part.y, part.size, part.size); 
                    }
                });
                
                ctx.restore(); // shake translate restore
                this.drawMinimap();
            }

            drawMinimap() {
                const ctx = this.ctx; const { x, y, w, h } = this.minimapRect;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)'; ctx.strokeStyle = 'rgba(0, 242, 255, 0.2)'; ctx.lineWidth = 1;
                ctx.beginPath(); ctx.roundRect(x, y, w, h, 5); ctx.fill(); ctx.stroke();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)'; ctx.beginPath(); ctx.moveTo(x, y + h/2); ctx.lineTo(x + w, y + h/2); ctx.stroke();
                this.players.forEach(p => { const px = x + (p.x / this.raceLength) * w; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(px, y + h/2, 4, 0, Math.PI * 2); ctx.fill(); });
                const viewW = (this.canvas.width / this.raceLength) * w;
                const viewX = (this.cameraX / this.raceLength) * w + x;
                ctx.strokeStyle = 'rgba(0, 242, 255, 0.8)'; ctx.lineWidth = 2;
                ctx.strokeRect(viewX, y, viewW, h); ctx.fillStyle = 'rgba(0, 242, 255, 0.1)'; ctx.fillRect(viewX, y, viewW, h);
            }

                        animate(timestamp) {

                            const dt = (timestamp - this.lastUpdate) / 1000;

                            this.lastUpdate = timestamp;

                            this.update(dt);

                            this.draw();

                            if (this.isRunning || this.particles.length > 0 || this.isDraggingMinimap || this.isCelebrating) {

                                requestAnimationFrame((ts) => this.animate(ts));

                            }

                        }

            

            getResultText() {
                // Í≤åÏûÑ Ï§ëÏù¥ ÏïÑÎãàÍ≥† Ï¥àÍ∏∞ÌôîÎêú ÏÉÅÌÉúÎùºÎ©¥ ÎßàÏßÄÎßâ Ï†ÄÏû•Îêú Í≤∞Í≥ºÎ•º Î∞òÌôò
                if (!this.isRunning && !this.isCelebrating && this.lastResultText && this.players.every(p => !p.finished)) {
                    return this.lastResultText;
                }

                const sorted = [...this.players].sort((a, b) => {
                    if (a.finished && b.finished) return a.finishTime - b.finishTime;
                    if (a.finished) return -1;
                    if (b.finished) return 1;
                    return b.x - a.x;
                });

                const getMedal = (rank) => {
                    if (rank === 1) return "ü•á ";
                    if (rank === 2) return "ü•à ";
                    if (rank === 3) return "ü•â ";
                    return "";
                };

                let text = "üåå ÎÑ§Ïò® Î†àÏù¥Ïä§ Í≤∞Í≥º üåå\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
                sorted.forEach((p, i) => {
                    const rank = i + 1;
                    if (p.finished && this.gameStartTime > 0) {
                        const time = (p.finishTime - this.gameStartTime) / 1000;
                        text += `${rank}Îì±: ${p.emoji} ${p.name} (${getMedal(rank)}${time.toFixed(2)}s)\n`;
                    } else {
                        const progress = Math.floor((p.x / this.raceLength) * 100);
                        text += `${rank}Îì±: ${p.emoji} ${p.name} (${progress}% ÏßÑÌñâ Ï§ë)\n`;
                    }
                });
                return text;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gameCanvas');
            const game = new NeonRace(canvas);
            const participantsInput = document.getElementById('participants');
            const raceLengthSlider = document.getElementById('raceLengthSlider');
            const raceLengthValue = document.getElementById('lengthValue');
            const densitySlider = document.getElementById('densitySlider');
            const densityValue = document.getElementById('densityValue');

            function parseParticipants(input) {
                const names = input.split(/[,\n]/).map(n => n.trim()).filter(n => n);
                const result = [];
                for (const name of names) {
                    const match = name.match(/^(.+)\*(\d+)$/);
                    if (match) {
                        const baseName = match[1].trim();
                        const count = parseInt(match[2]);
                        for (let i = 0; i < count; i++) result.push(baseName);
                    } else { result.push(name); }
                }
                return result;
            }

            function getDensityText(val) { 
                if (val < 40) return "Ï†ÅÏùå"; if (val < 70) return "Î≥¥ÌÜµ"; if (val < 90) return "ÎßéÏùå"; return "Îß§Ïö∞ ÎßéÏùå";
            }

            function updateInit(shouldShuffle = false) {
                const names = parseParticipants(participantsInput.value);
                const length = parseInt(raceLengthSlider.value);
                const density = parseInt(densitySlider.value);
                game.prepare(names, length, density, shouldShuffle);
                localStorage.setItem('neon-race-participants', participantsInput.value);
                localStorage.setItem('neon-race-length', length);
                localStorage.setItem('neon-race-density', density);
            }

            participantsInput.addEventListener('input', () => updateInit(false));
            raceLengthSlider.addEventListener('input', (e) => { raceLengthValue.textContent = e.target.value; updateInit(false); });
            densitySlider.addEventListener('input', (e) => { densityValue.textContent = getDensityText(e.target.value); updateInit(false); });

            document.getElementById('startBtn').addEventListener('click', () => { if (game.isRunning) return; game.start(); });
            document.getElementById('resetBtn').addEventListener('click', () => { updateInit(true); });
            document.getElementById('finishBtn').addEventListener('click', () => { game.forceFinish(); });
            document.getElementById('helpBtn').addEventListener('click', () => { alert('üåå ÎÑ§Ïò® Î†àÏù¥Ïä§\n\n1. Ï∞∏Ïó¨ÏûêÎì§Ïù¥ ÎÑ§Ïò® ÎèÑÏãúÎ•º ÏßàÏ£ºÌï©ÎãàÎã§.\n2. ÌååÎûÄÏÉâ Ïú°Í∞ÅÌòïÏùÄ Í∞ÄÏÜç(Boost), Îπ®Í∞ÑÏÉâÏùÄ Í∞êÏÜç(Slow)ÏûÖÎãàÎã§.\n3. üéÅ ÏïÑÏù¥ÌÖú Î∞ïÏä§Î•º ÌöçÎìùÌïòÏó¨ ÎßàÎ¶¨Ïò§ Ïπ¥Ìä∏Ï≤òÎüº Ïó≠Ï†ÑÌï† Ïàò ÏûàÏäµÎãàÎã§.\n4. ÌïòÎã® ÎØ∏ÎãàÎßµÏùÑ ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏãúÏ†êÏùÑ Í≥†Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\n5. ‚Ü∫ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Ï∞∏Ïó¨Ïûê ÏàúÏÑúÍ∞Ä Î¨¥ÏûëÏúÑÎ°ú ÏÑûÏûÖÎãàÎã§.'); });
            document.getElementById('restartBtn').addEventListener('click', () => { document.getElementById('winnerOverlay').classList.remove('show'); updateInit(false); });
            document.getElementById('copyResultBtn').addEventListener('click', () => { const text = game.getResultText(); navigator.clipboard.writeText(text).then(() => alert('Í≤∞Í≥ºÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!')); });
            document.getElementById('copyResultOverlayBtn').addEventListener('click', () => { const text = game.getResultText(); navigator.clipboard.writeText(text).then(() => alert('Í≤∞Í≥ºÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!')); });

            const savedNames = localStorage.getItem('neon-race-participants');
            if (savedNames) participantsInput.value = savedNames;
            const savedLength = localStorage.getItem('neon-race-length');
            if (savedLength) { raceLengthSlider.value = savedLength; raceLengthValue.textContent = savedLength; }
            const savedDensity = localStorage.getItem('neon-race-density');
            if (savedDensity) { densitySlider.value = savedDensity; densityValue.textContent = getDensityText(savedDensity); }

            updateInit(false);
        });
    </script>
</body>
</html>
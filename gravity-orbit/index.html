<!--
@game-meta
{
  "id": "gravity-orbit",
  "title": "Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ Ï∂îÏ≤® (Gravity Orbit Survival)",
  "emoji": "ü™ê",
  "category": "ÏÑúÎ∞îÏù¥Î≤å",
  "description": "Ï§ëÎ†•Ïû• ÏïàÏóêÏÑú Í∂§ÎèÑÎ•º Í∑∏Î¶¨Î©∞ ÎÅùÍπåÏßÄ ÏÇ¥ÏïÑÎÇ®Í±∞ÎÇò ÏïàÏ†ïÏ†ÅÏù∏ Í∂§ÎèÑÎ•º Ïú†ÏßÄÌïòÎäî Ï∞∏Í∞ÄÏûêÍ∞Ä ÏäπÎ¶¨ÌïòÎäî Î¨ºÎ¶¨ Í∏∞Î∞ò Ï∂îÏ≤® Í≤åÏûÑÏûÖÎãàÎã§.",
  "features": ["üåç ÏµúÌõÑÏùò 1Ïù∏ ÏÑúÎ∞îÏù¥Î≤å", "üß¨ Seed Í∏∞Î∞ò Ï†ïÎ∞Ä Î¨ºÎ¶¨"],
  "color": "purple",
  "badge": "NEW",
  "version": "1.0.0",
  "updated": "2025-12-26",
  "author": {
    "name": "Euiyun Edwin Kim",
    "email": "geniuskey@gmail.com",
    "github": "geniuskey"
  },
  "urls": {
    "service": "https://geniuskey.github.io/lottery/gravity-orbit/",
    "repository": "https://github.com/geniuskey/lottery"
  },
  "license": "MIT",
  "copyright": "¬© 2025 Euiyun Edwin Kim. Licensed under the MIT License."
}
@end-game-meta
-->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GFTNV73W8L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GFTNV73W8L');
    </script>

    <title>Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ - Ï∂îÏ≤® Í≤åÏûÑ Ìè¨ÌÑ∏</title>

    <!-- SEO Í∏∞Î≥∏ -->
    <meta name="description" content="Ï§ëÎ†•Ïû• ÏÜçÏóêÏÑú Í∂§ÎèÑÎ•º Ïú†ÏßÄÌïòÎ©∞ ÏÇ¥ÏïÑÎÇ®ÏúºÏÑ∏Ïöî! Î¨ºÎ¶¨ ÏóîÏßÑ Í∏∞Î∞òÏùò Ïö∞Ï£º ÏÑúÎ∞îÏù¥Î≤å Ïò®ÎùºÏù∏ Ï∂îÏ≤® Í≤åÏûÑ.">
    <meta name="author" content="Euiyun Edwin Kim">
    <meta name="keywords" content="Ï§ëÎ†• Í≤åÏûÑ, Í∂§ÎèÑ ÏÉùÏ°¥, Ïö∞Ï£º Í≤åÏûÑ, Ï∂îÏ≤® Í≤åÏûÑ, Ïò®ÎùºÏù∏ Ï∂îÏ≤®, ÎûúÎç§ ÏÑ†ÌÉù, Î¨ºÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖò">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Ï∂îÏ≤® Í≤åÏûÑ Ìè¨ÌÑ∏">
    <meta property="og:title" content="ü™ê Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ - Ïã†ÎπÑÎ°úÏö¥ Ïö∞Ï£º Ï∂îÏ≤®">
    <meta property="og:description" content="ÏïàÏ†ïÏ†ÅÏù∏ Í∂§ÎèÑÎ•º Ïú†ÏßÄÌïòÏßÄ Î™ªÌïòÎ©¥ Ïö∞Ï£º ÎØ∏ÏïÑÍ∞Ä Îê©ÎãàÎã§! ÏµúÌõÑÏùò ÏÉùÏ°¥ÏûêÎ•º Í∞ÄÎ¶¨Îäî Ï∂îÏ≤® Í≤åÏûÑ.">
    <meta property="og:url" content="https://geniuskey.github.io/lottery/gravity-orbit/">
    <meta property="og:image" content="https://geniuskey.github.io/lottery/og-image.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ü™ê Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ - Ïã†ÎπÑÎ°úÏö¥ Ïö∞Ï£º Ï∂îÏ≤®">
    <meta name="twitter:description" content="ÏïàÏ†ïÏ†ÅÏù∏ Í∂§ÎèÑÎ•º Ïú†ÏßÄÌïòÏßÄ Î™ªÌïòÎ©¥ Ïö∞Ï£º ÎØ∏ÏïÑÍ∞Ä Îê©ÎãàÎã§! ÏµúÌõÑÏùò ÏÉùÏ°¥ÏûêÎ•º Í∞ÄÎ¶¨Îäî Ï∂îÏ≤® Í≤åÏûÑ.">
    <meta property="twitter:image" content="https://geniuskey.github.io/lottery/og-image.png">
    
    <!-- Canonical & Favicon -->
    <link rel="canonical" href="https://geniuskey.github.io/lottery/gravity-orbit/">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü™ê</text></svg>">
    <meta name="robots" content="index, follow">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü™ê</text></svg>">
  
    <link
        href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050510;
            --bg-gradient: radial-gradient(circle at center, #1a1a2e 0%, #050510 100%);
            --accent-purple: #a855f7;
            --accent-cyan: #00d4ff;
            --accent-pink: #ff6b9d;
            --accent-gold: #ffd700;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 320px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(168, 85, 247, 0.3);
            border-radius: 10px;
            transition: 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
            box-shadow: 0 0 10px var(--accent-purple);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-dark);
            background-image: var(--bg-gradient);
            color: #fff;
            height: 100vh;
            overflow: hidden;
            display: flex;
            touch-action: manipulation;
        }

        /* Layout */
        .container {
            display: flex;
            width: 100%;
            height: 100vh;
            padding: 0; /* Ï†úÍ±∞: 20px -> 0 */
            gap: 0;    /* Ï†úÍ±∞: 20px -> 0 */
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: none;
            border-right: 1px solid var(--glass-border);
            border-radius: 0; /* Ï†úÍ±∞: 24px -> 0 */
            display: flex;
            flex-direction: column;
            padding: 24px;
            gap: 20px;
            z-index: 10;
        }

        .main-content {
            flex: 1;
            position: relative;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: none;
            border-radius: 0; /* Ï†úÍ±∞: 24px -> 0 */
            overflow: hidden;
        }

        /* Sidebar Elements */
        .logo-area {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .logo {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            letter-spacing: -0.8px;
        }

        .logo .title-emoji {
            filter: drop-shadow(0 0 5px rgba(0, 212, 255, 0.5));
            -webkit-text-fill-color: initial;
            background: none;
        }

        .logo .title-text {
            /* ÌîÑÎ¶¨ÎØ∏ÏóÑ Í∏àÏÜç Í¥ëÌÉù Ìö®Í≥º */
            background: linear-gradient(
                to right, 
                var(--accent-cyan) 0%, 
                #fff 45%, 
                #fff 55%, 
                var(--accent-cyan) 100%
            );
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 5s linear infinite;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        .header-btns {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .help-btn, .sound-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: transparent;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .help-btn:hover, .sound-btn:hover {
            border-color: var(--accent-cyan);
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-2px);
        }

        .section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        textarea {
            width: 100%;
            height: 120px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 12px;
            color: #fff;
            font-family: inherit;
            font-size: 13px;
            resize: none;
            transition: 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.2);
        }

        .select-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        select,
        input[type="text"],
        input[type="number"] {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 60px;
            gap: 10px;
        }

        .btn {
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
            color: #fff;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:disabled {
            filter: grayscale(1);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-primary:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .btn-secondary {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Ranking Board */
        .ranking-area {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #rankingList {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 14px;
            transition: 0.3s;
        }

        .ranking-item:last-child {
            margin-bottom: 0;
        }

        .rank {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--glass);
            border-radius: 6px;
            font-weight: 700;
            font-size: 12px;
        }

        .ranking-item .rank.rank-1 {
            background: linear-gradient(135deg, #fbbf24, #b45309);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }

        .ranking-item .rank.rank-2 {
            background: linear-gradient(135deg, #e2e8f0, #475569);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 12px rgba(226, 232, 240, 0.2);
        }

        .ranking-item .rank.rank-3 {
            background: linear-gradient(135deg, #d97706, #78350f);
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 10px rgba(217, 119, 6, 0.2);
        }

        /* Toast Popup */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 100000;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s;
            opacity: 0;
            pointer-events: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .ranking-item .name {
            flex: 1;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ranking-item .metrics {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            margin-right: 12px;
            line-height: 1.1;
        }

        .ranking-item .status {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--accent-cyan);
            font-weight: 700;
            min-width: 65px;
            text-align: right;
        }

        .ranking-item .status.eliminated {
            color: rgba(255, 255, 255, 0.3);
            font-weight: 400;
        }

        .particle-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status {
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-cyan);
        }

        .status.eliminated {
            color: var(--accent-pink);
            opacity: 0.6;
        }

        /* Sidebar Footer */
        .sidebar-footer {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            text-decoration: none;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-cyan);
        }

        /* Canvas Area */
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .copyright {
            position: absolute;
            bottom: 15px;
            right: 20px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.3);
            pointer-events: none;
            user-select: none;
        }

        /* Seed Info Overlay */
        .seed-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            border: 1px solid var(--glass-border);
            color: var(--accent-cyan);
            pointer-events: none;
            z-index: 100;
        }

        /* Kill Feed */
        .kill-feed {
            position: absolute;
            top: 60px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none;
            z-index: 1000;
            align-items: flex-end;
        }

        .kill-item {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            border-left: 3px solid var(--accent-pink);
            color: rgba(255, 255, 255, 0.9);
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            animation: killSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards,
                killFadeOut 0.5s ease-in 4s forwards;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--accent-pink);
        }

        @keyframes killSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes killFadeOut {
            to {
                transform: translateX(20px);
                opacity: 0;
            }
        }

        /* Cinematic Victory Overlay (Transplanted from Neon Race style) */
        .winner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(15px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 40px 20px;
            z-index: 10000;
            overflow-y: auto;
        }

        .winner-overlay.active {
            display: flex;
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .result-header {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 40px;
        }

        .winner-label {
            font-size: 1.2rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 6px;
            margin-bottom: 15px;
        }

        .winner-title {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 5rem;
            color: var(--accent-purple);
            margin-bottom: 10px;
            text-shadow: 0 0 30px var(--accent-purple);
            animation: championGlow 2s infinite alternate, championPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes championGlow {
            0% {
                text-shadow: 0 0 20px var(--accent-purple), 0 0 40px var(--accent-cyan);
                color: #fff;
            }

            100% {
                text-shadow: 0 0 50px var(--accent-cyan), 0 0 80px var(--accent-purple);
                color: var(--accent-purple);
            }
        }

        @keyframes championPop {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .winner-name-display {
            font-size: 3.5rem;
            color: #fff;
            margin-bottom: 40px;
            animation: namePulse 1.5s infinite ease-in-out;
            font-family: 'Black Han Sans', sans-serif;
        }

        @keyframes namePulse {

            0%,
            100% {
                transform: scale(1);
                text-shadow: 0 0 15px #fff;
            }

            50% {
                transform: scale(1.05);
                text-shadow: 0 0 30px var(--accent-cyan);
                color: var(--accent-cyan);
            }
        }

        .final-rankings {
            width: 100%;
            max-width: 520px;
            max-height: 40vh;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 40px;
            scrollbar-width: thin;
        }

        .final-rankings::-webkit-scrollbar {
            width: 6px;
        }

        .final-rankings::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .final-ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 20px;
            border-radius: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.02);
            animation: resultSlideIn 0.5s ease forwards;
            opacity: 0;
            border: 1px solid transparent;
        }

        @keyframes resultSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .final-ranking-item.rank-1 {
            background: linear-gradient(90deg, rgba(234, 179, 8, 0.15), transparent);
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .final-ranking-item.rank-2 {
            background: linear-gradient(90deg, rgba(148, 163, 184, 0.1), transparent);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .final-ranking-item.rank-3 {
            background: linear-gradient(90deg, rgba(180, 83, 9, 0.1), transparent);
            border: 1px solid rgba(180, 83, 9, 0.2);
        }

        .final-pos {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            font-weight: 800;
            font-size: 1rem;
        }

        .rank-1 .final-pos {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: #000;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
        }

        .rank-2 .final-pos {
            background: linear-gradient(135deg, #e2e8f0, #94a3b8);
            color: #000;
        }

        .rank-3 .final-pos {
            background: linear-gradient(135deg, #f59e0b, #b45309);
            color: #fff;
        }

        .final-name {
            flex: 1;
            font-weight: 600;
            font-size: 1.2rem;
            color: #fff;
        }

        .final-score {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .rank-1 .final-score,
        .rank-2 .final-score,
        .rank-3 .final-score {
            color: #fff;
            font-weight: 600;
        }

        .result-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            width: 100%;
            max-width: 520px;
        }

        .winner-btn {
            flex: 1;
            padding: 18px;
            font-size: 1.1rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
        }

        /* Global Game Timer */
        #gameTimer {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            padding: 10px 24px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            border: 1px solid var(--glass-border);
            color: var(--accent-cyan);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 0 10px rgba(0, 212, 255, 0.2);
            z-index: 150;
            display: none;
            text-align: center;
            min-width: 140px;
        }

        #gameTimer.active {
            display: block;
        }

        /* Result Overlay */
        .result-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            animation: fadeIn 0.5s ease-out;
        }

        .result-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .winner-card {
            text-align: center;
            padding: 40px;
            border-radius: 32px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .winner-label {
            font-size: 1.2rem;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 20px;
        }

        .winner-name {
            font-family: 'Black Han Sans', sans-serif;
            font-size: 5rem;
            background: linear-gradient(135deg, var(--accent-gold), #fff, var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.4));
            animation: winnerPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes winnerPop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .winner-card {
            display: contents;
            /* Effectively removes the card wrapper visual */
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
                height: auto;
            }

            .container {
                flex-direction: column-reverse;
                padding: 0;
                gap: 0;
                height: auto;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: 20px;
                gap: 16px;
                flex: none;
                border-radius: 0;
                border: none;
                border-top: 1px solid var(--glass-border);
            }

            .main-content {
                width: 100%;
                height: 75vh;
                min-height: 500px;
                flex: none;
                border-radius: 0;
                border: none;
            }

            .logo {
                font-size: 1.1rem;
            }

            textarea {
                height: 80px;
            }

            .ranking-area {
                max-height: 300px;
            }

            .winner-title {
                font-size: 3rem;
            }

            .winner-name-display {
                font-size: 2rem;
            }

            .final-rankings {
                max-height: 30vh;
                padding: 12px;
            }

            .result-buttons {
                flex-direction: column;
                gap: 10px;
            }

            #gameTimer {
                font-size: 1.2rem;
                padding: 6px 12px;
            }

            .kill-feed {
                top: 50px;
                right: 10px;
            }

            .kill-item {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo-area">
                <h1 class="logo"><span class="title-emoji">ü™ê</span> <span class="title-text">Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥</span></h1>
                <div class="header-btns">
                    <button class="sound-btn" id="soundToggle" title="ÏÜåÎ¶¨ ÏºúÍ∏∞/ÎÅÑÍ∏∞">üîä</button>
                    <button class="help-btn" id="helpBtn">?</button>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Ï∞∏Ïó¨Ïûê Î™ÖÎã®</div>
                <textarea id="participantsInput" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏâºÌëú ÎòêÎäî Ï§ÑÎ∞îÍøà)&#10;Ïòà: ÍπÄÏ≤†Ïàò, Ïù¥ÏòÅÌù¨*3, Î∞ïÎØºÏàò"></textarea>
            </div>

            <div class="section" style="display: none;">
                <div class="section-title">Í≤åÏûÑ ÏÑ§Ï†ï</div>
                <div class="select-group">
                    <select id="winCondition">
                        <option value="survival" selected>A. ÏµúÌõÑÏùò ÏÉùÏ°¥Ïûê (Survival Time)</option>
                    </select>
                    <input type="text" id="manualSeed" placeholder="Ïª§Ïä§ÌÖÄ Seed (ÎπÑÏõåÎëêÎ©¥ ÏûêÎèô)">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 12px; color: #888;">ÎãπÏ≤® Ïù∏Ïõê:</span>
                        <input type="number" id="winnerCount" value="1" min="1" max="10" style="width: 60px;">
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button id="startBtn" class="btn btn-primary">üéÆ ÏãúÏûë</button>
                <button id="resetBtn" class="btn btn-secondary">‚Ü∫</button>
            </div>

            <div class="ranking-area">
                <div
                    style="padding: 12px 16px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
                    <span class="section-title" style="margin:0;">Ïã§ÏãúÍ∞Ñ Îû≠ÌÇπ</span>
                    <span id="liveStatus" style="font-size: 10px; color: var(--accent-pink); display: none;">‚óè
                        LIVE</span>
                </div>
                <div id="rankingList">
                    <!-- Ranking items will be added here -->
                    <div style="text-align: center; color: #555; font-size: 13px; margin-top: 20px;">Ï∞∏Ïó¨ÏûêÎ•º ÏûÖÎ†•ÌïòÍ≥† ÏãúÏûëÌïòÏÑ∏Ïöî
                    </div>
                </div>
            </div>

            <div class="sidebar-footer">
                <a href="../" class="icon-btn" data-tooltip="Ï∂îÏ≤® Ìè¨ÌÉà Ìôà">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </a>
                <button class="icon-btn" id="copyResultBtn" data-tooltip="Í≤∞Í≥º Î≥µÏÇ¨">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                </button>
                <a href="https://github.com/geniuskey/lottery" target="_blank" class="icon-btn"
                    data-tooltip="GitHub Ï†ÄÏû•ÏÜå">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z">
                        </path>
                    </svg>
                </a>
                <a href="https://buymeacoffee.com/euiyun" target="_blank" class="icon-btn" data-tooltip="Ïª§Ìîº ÏÇ¨Ï£ºÍ∏∞ ‚òï">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364z">
                        </path>
                    </svg>
                </a>
            </div>
        </aside>

        <main class="main-content" id="gameArea">
            <div id="gameTimer">0.00s</div>
            <div id="seedDisplay" class="seed-info" style="display: none;">HASH: N/A</div>
            <div id="killFeed" class="kill-feed"></div>
            <canvas id="gameCanvas"></canvas>
            <div class="copyright">¬© 2025 Euiyun Edwin Kim.</div>
        </main>
    </div>

    <canvas id="celebCanvas"
        style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:11000; pointer-events:none;"></canvas>

    <div class="winner-overlay" id="resultOverlay">
        <div class="result-header">
            <div class="winner-label">üèÜ CHAMPION</div>
            <div class="winner-title">GRAVITY SURVIVOR</div>
            <div class="winner-name-display" id="winnerName">-</div>
        </div>
        <div class="final-rankings">
            <div
                style="font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; text-align: center;">
                üèÅ FINAL RANKINGS</div>
            <div id="finalRankingList"></div>
        </div>
        <div class="result-buttons">
            <button class="btn btn-secondary winner-btn" id="copyResultOverlayBtn"
                style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">üìã Í≤∞Í≥º Î≥µÏÇ¨</button>
            <button class="btn btn-primary winner-btn" id="restartBtn"
                onclick="document.getElementById('resultOverlay').classList.remove('active')">ÌôïÏù∏</button>
        </div>
    </div>

    <script>
        /**
         * 0. Audio Engine
         */
        class SoundManager {
            constructor() {
                this.ctx = null;
                this.enabled = true;
                this.setupToggleButton();
            }
            setupToggleButton() {
                const btn = document.getElementById('soundToggle');
                if (btn) {
                    btn.onclick = () => {
                        this.enabled = !this.enabled;
                        btn.textContent = this.enabled ? 'üîä' : 'üîá';
                        if (this.enabled && this.ctx && this.ctx.state === 'suspended') {
                            this.ctx.resume();
                        }
                    };
                }
            }
            init() {
                if (this.ctx) return;
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            }
            playStart() {
                if (!this.enabled || !this.ctx) return;
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(40, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(200, this.ctx.currentTime + 1);
                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 1);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 1);
            }
            playCrash() {
                if (!this.enabled || !this.ctx) return;
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                const filter = this.ctx.createBiquadFilter();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(20, this.ctx.currentTime + 0.5);
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1000, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.15, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.5);
                osc.connect(filter); filter.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.5);
            }
            playLost() {
                if (!this.enabled || !this.ctx) return;
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(200, this.ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, this.ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.3);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.3);
            }
            playWin() {
                if (!this.enabled || !this.ctx) return;
                this.init();
                const notes = [261.63, 329.63, 392.00, 523.25];
                notes.forEach((freq, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime + i * 0.1);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime + i * 0.1);
                    gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + i * 0.1 + 0.4);
                    osc.connect(gain); gain.connect(this.ctx.destination);
                    osc.start(this.ctx.currentTime + i * 0.1);
                    osc.stop(this.ctx.currentTime + i * 0.1 + 0.4);
                });
            }
        }

        /**
         * 1. Utilities & Seeding
         */
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastText = toast.querySelector('.toast-text');
            toastText.innerText = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }


        class MouseParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = Math.random() * 2 + 1;
                this.alpha = 1.0;
                this.color = Math.random() < 0.5 ? '#7dd3fc' : '#fff'; // Cyan or White
            }
            update(dt) {
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= dt * 1.5;
            }
            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = Math.max(0, this.alpha);
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class ExplosionParticle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 4 + 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.size = Math.random() * 3 + 1;
                this.alpha = 1.0;
                this.color = color;
            }
            update(dt) {
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.96;
                this.vy *= 0.96;
                this.alpha -= dt * 1.2;
            }
            draw(ctx) {
                if (this.alpha <= 0) return;
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class DeterministicRNG {
            constructor(seedStr) {
                this.seed = this.hashString(seedStr);
            }
            hashString(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    hash = ((hash << 5) - hash) + str.charCodeAt(i);
                    hash |= 0;
                }
                return hash;
            }
            next() {
                this.seed = (this.seed * 16807) % 2147483647;
                return (this.seed - 1) / 2147483646;
            }
            range(min, max) {
                return min + this.next() * (max - min);
            }
        }

        /**
         * 2. Physics Engine
         */
        const CONFIG = {
            G: 1200, // Gravitational Constant
            FRICTION: 0.9995, // Space friction
            PLANET_MASS: 6000,
            PLANET_RADIUS: 45,
            LBound: 600, // Edge distance from center
            PARTICLE_RADIUS: 6,
            TARGET_RADIUS: 180,
            TARGET_WIDTH: 40
        };

        class Particle {
            constructor(name, x, y, vx, vy, color) {
                this.name = name;
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.color = color;
                this.isEliminated = false;
                this.reason = "";
                this.survivalTime = 0;
                this.orbitPoints = [];
                this.score = 0;
                this.history = [];
                this.minDist = Infinity;
                this.maxDist = 0;
            }

            update(dt, planet) {
                if (this.isEliminated) return;

                const dx = planet.x - this.x;
                const dy = planet.y - this.y;
                const distSq = dx * dx + dy * dy;
                const dist = Math.sqrt(distSq);

                // Track Min/Max Radius
                if (dist < this.minDist) this.minDist = dist;
                if (dist > this.maxDist) this.maxDist = dist;

                // Boundary detection (relative to planet, fixed radius for stability)
                const centerDist = Math.max(Math.abs(this.x - planet.x), Math.abs(this.y - planet.y));
                if (centerDist > 1200) { // Stable absolute boundary
                    this.isEliminated = true;
                    this.reason = "LOST";
                    if (typeof game !== 'undefined') {
                        game.addKillMessage(this.name, this.reason);
                        game.sound.playLost();
                    }
                    return;
                }

                // Planet Collision
                if (dist < CONFIG.PLANET_RADIUS + CONFIG.PARTICLE_RADIUS) {
                    this.isEliminated = true;
                    this.reason = "CRASHED";
                    if (typeof game !== 'undefined') {
                        game.createExplosion(this.x, this.y, this.color);
                        game.addKillMessage(this.name, this.reason);
                        game.sound.playCrash();
                    }
                    return;
                }

                // Gravity Force
                const force = (CONFIG.G * CONFIG.PLANET_MASS) / Math.max(distSq, 400);
                const ax = (force * dx) / dist;
                const ay = (force * dy) / dist;

                this.vx += ax * dt;
                this.vy += ay * dt;

                // Friction
                const drag = Math.pow(CONFIG.FRICTION, dt * 60);
                this.vx *= drag;
                this.vy *= drag;

                this.x += this.vx * dt * 60;
                this.y += this.vy * dt * 60;

                this.survivalTime += dt;

                // Sampling points for stability score
                if (Math.floor(this.survivalTime * 10) > this.orbitPoints.length) {
                    this.orbitPoints.push({ d: dist });
                }

                // Trails - every frame for smooth tracking
                this.history.push({ x: this.x, y: this.y });
                if (this.history.length > 60) this.history.shift();
            }

            draw(ctx) {
                if (this.isEliminated) return;

                // Glowing Smooth Trail (Spline-like with Quadratic Bezier)
                if (this.history.length > 3) {
                    ctx.save();
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';

                    for (let i = 0; i < this.history.length - 2; i++) {
                        const p0 = this.history[i];
                        const p1 = this.history[i + 1];
                        const p2 = this.history[i + 2];

                        // Midpoints for smooth connection
                        const mid1 = { x: (p0.x + p1.x) / 2, y: (p0.y + p1.y) / 2 };
                        const mid2 = { x: (p1.x + p2.x) / 2, y: (p1.y + p2.y) / 2 };

                        ctx.beginPath();
                        ctx.moveTo(mid1.x, mid1.y);
                        ctx.quadraticCurveTo(p1.x, p1.y, mid2.x, mid2.y);

                        ctx.strokeStyle = this.color;
                        ctx.globalAlpha = (i / this.history.length) * 0.4;
                        ctx.stroke();
                    }
                    ctx.restore();
                }

                // Particle Head - Minimalist line-only style
                ctx.fillStyle = "#fff";
                ctx.textAlign = "center";

                // Unscale the text so it stays constant size regardless of zoom
                const zoom = (typeof game !== 'undefined') ? game.zoom : 1;
                ctx.save();
                ctx.translate(this.x, this.y - 18 / zoom);
                ctx.scale(1 / zoom, 1 / zoom);

                const fontSize = 14;
                ctx.font = `bold ${fontSize}px 'Noto Sans KR'`;
                const textWidth = ctx.measureText(this.name).width;

                // Shadow / Box
                ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
                ctx.beginPath();
                ctx.roundRect(-textWidth / 2 - 4, -fontSize - 2, textWidth + 8, fontSize + 4, 4);
                ctx.fill();

                ctx.fillStyle = "#fff";
                ctx.fillText(this.name, 0, 0);
                ctx.restore();
                // Removed extra restore for particle dot
            }
        }

        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.celebCanvas = document.getElementById('celebCanvas');
                this.celebCtx = this.celebCanvas.getContext('2d');
                this.particles = [];
                this.planet = { x: 0, y: 0 };
                this.isRunning = false;
                this.isCelebrating = false;
                this.lastTime = 0;
                this.rng = null;
                this.gameTime = 0;
                this.winCondition = 'survival';
                this.stars = [];
                this.mouseParticles = [];
                this.celebParticles = [];
                this.explosionParticles = [];
                this.mousePos = { x: -100, y: -100 };
                this.zoom = 1.0;
                this.targetZoom = 1.0;
                this.sound = new SoundManager();

                window.addEventListener('resize', () => this.resize());
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mousePos.x = e.clientX - rect.left;
                    this.mousePos.y = e.clientY - rect.top;

                    for (let i = 0; i < 2; i++) {
                        // 70% of previous density (3 * 0.7 = 2.1, so 2 per move is approx correct)
                        this.mouseParticles.push(new MouseParticle(this.mousePos.x, this.mousePos.y));
                    }
                });
                this.canvas.addEventListener('mouseleave', () => {
                    this.mousePos = { x: -1000, y: -1000 };
                });
                this.resize();
                this.initStars();

                // Start idle loop
                requestAnimationFrame((t) => this.loop(t));
            }

            initStars() {
                this.stars = [];
                const colors = ['#fff', '#fff', '#fff', '#fff', '#fff', '#fff', '#fff', '#7dd3fc', '#fcd34d', '#f472b6']; // Predominantly white, some colored
                for (let i = 0; i < 1000; i++) {
                    this.stars.push({
                        x: Math.random(),
                        y: Math.random(),
                        size: Math.random() < 0.2 ? 1.8 : 0.8,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        brightness: 0.4 + Math.random() * 0.6,
                        twinkleSpeed: 0.003 + Math.random() * 0.008,
                        phase: Math.random() * Math.PI * 2
                    });
                }
            }

            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;

                // Sync celebration canvas
                this.celebCanvas.width = window.innerWidth;
                this.celebCanvas.height = window.innerHeight;

                this.planet.x = this.canvas.width / 2;
                this.planet.y = this.canvas.height / 2;
                this.initStars();
            }


            async start() {
                const input = document.getElementById('participantsInput').value;
                const names = this.parseParticipants(input);
                if (names.length === 0) return alert("Ï∞∏Ïó¨ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");

                // Reset for new game
                this.isRunning = true;
                this.sound.init();
                this.sound.playStart();
                this.particles = [];
                this.gameTime = 0;
                this.zoom = 1.0;
                this.targetZoom = 1.0;
                document.getElementById('rankingList').innerHTML = "";
                this.lastTime = performance.now();
                this.winCondition = document.getElementById('winCondition').value;

                const manualSeed = document.getElementById('manualSeed').value;
                const seedBase = manualSeed || (names.join('') + Date.now());
                const fullHash = await sha256(seedBase);
                this.rng = new DeterministicRNG(fullHash);

                document.getElementById('seedDisplay').innerText = "HASH: " + fullHash.substring(0, 16).toUpperCase();
                document.getElementById('seedDisplay').style.display = "block";

                this.particles = names.map(name => {
                    const angle = this.rng.range(0, Math.PI * 2);
                    const spawnDist = this.rng.range(350, 480); // Increased distance from planet
                    const orbitSpeed = Math.sqrt((CONFIG.G * CONFIG.PLANET_MASS) / spawnDist) * 0.12; // Even slower
                    const speed = orbitSpeed * this.rng.range(0.9, 1.1); // Lower variance for majestic flow

                    const x = this.planet.x + Math.cos(angle) * spawnDist;
                    const y = this.planet.y + Math.sin(angle) * spawnDist;

                    const vx = -Math.sin(angle) * speed;
                    const vy = Math.cos(angle) * speed;

                    const hue = this.rng.range(0, 360);
                    return new Particle(name, x, y, vx, vy, `hsl(${hue}, 80%, 65%)`);
                });

                document.getElementById('startBtn').disabled = true;
                document.getElementById('liveStatus').style.display = "block";
            }

            parseParticipants(input) {
                const names = input.split(/[,\n]/).map(n => n.trim()).filter(n => n);
                const result = [];
                for (const name of names) {
                    const match = name.match(/^(.+)\*(\d+)$/);
                    if (match) {
                        const baseName = match[1].trim();
                        const count = Math.min(parseInt(match[2]), 100);
                        for (let i = 0; i < count; i++) result.push(baseName);
                    } else {
                        result.push(name);
                    }
                }
                return result;
            }

            loop(timestamp) {
                if (!this.lastTime) this.lastTime = timestamp;
                const elapsed = timestamp - this.lastTime;

                // Cap to 60 FPS
                if (elapsed >= 16.67) {
                    const dt = Math.min(elapsed / 1000, 0.1);
                    this.lastTime = timestamp;

                    if (this.isRunning) {
                        this.update(dt);
                        this.updateUI();

                        const alive = this.particles.filter(p => !p.isEliminated);
                        const winnerCountNeeded = parseInt(document.getElementById('winnerCount').value) || 1;

                        if (this.gameTime >= 40 || (this.winCondition === 'survival' && alive.length <= winnerCountNeeded && this.particles.length > winnerCountNeeded)) {
                            setTimeout(() => this.endGame(), 1000);
                        }
                    }

                    if (this.isCelebrating) {
                        this.updateCelebration();
                    }

                    this.draw();

                    if (this.isCelebrating) {
                        this.drawCelebration();
                    }
                }

                requestAnimationFrame((t) => this.loop(t));
            }

            update(dt) {
                this.gameTime += dt;
                let maxDist = 0;
                let aliveCount = 0;

                this.particles.forEach(p => {
                    p.update(dt, this.planet);
                    if (!p.isEliminated) {
                        const dx = p.x - this.planet.x;
                        const dy = p.y - this.planet.y;
                        maxDist = Math.max(maxDist, Math.sqrt(dx * dx + dy * dy));
                        aliveCount++;
                    }
                });

                // Dynamic Zoom Logic (Track the "Action Zone")
                if (this.isRunning && aliveCount > 0) {
                    const margin = 100; // Margin for name tags
                    const viewSize = Math.min(this.canvas.width, this.canvas.height) / 2;
                    const orbitRadius = Math.max(maxDist, CONFIG.PLANET_RADIUS + 40);
                    const idealZoom = viewSize / (orbitRadius + margin);

                    const nextTarget = Math.min(Math.max(idealZoom, 0.5), 40.0);
                    // One-way zoom: Only allow zoom-in (increasing scale) to prevent "heartbeat" zoom out
                    if (nextTarget > this.targetZoom) {
                        this.targetZoom = nextTarget;
                    }
                } else {
                    this.targetZoom = 1.0;
                }

                // Strictly limited zoom rate: fixed 0.1 units per second
                const zoomSpeed = 0.1;
                const maxDelta = zoomSpeed * dt;
                const diff = this.targetZoom - this.zoom;

                const clampedDiff = Math.max(-maxDelta, Math.min(maxDelta, diff));
                const nextZoom = this.zoom + clampedDiff;

                if (!isNaN(nextZoom) && isFinite(nextZoom)) {
                    this.zoom = nextZoom;
                }
            }

            draw() {
                // Reset transform to identity to prevent any accumulation from crashes
                this.ctx.setTransform(1, 0, 0, 1, 0, 0);

                // Clear background
                this.ctx.fillStyle = '#020205';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Mouse Neon Glow
                if (this.mousePos.x > 0) {
                    const glow = this.ctx.createRadialGradient(
                        this.mousePos.x, this.mousePos.y, 0,
                        this.mousePos.x, this.mousePos.y, 120
                    );
                    glow.addColorStop(0, 'rgba(6, 182, 212, 0.18)');
                    glow.addColorStop(1, 'rgba(0, 0, 0, 0)');
                    this.ctx.fillStyle = glow;
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                }

                // Update & Draw Mouse Particles
                this.mouseParticles = this.mouseParticles.filter(p => p.alpha > 0);
                this.mouseParticles.forEach(p => {
                    p.update(1 / 60);
                    p.draw(this.ctx);
                });

                this.ctx.save();

                // Scale from center
                this.ctx.translate(this.planet.x, this.planet.y);
                this.ctx.scale(this.zoom, this.zoom);
                this.ctx.translate(-this.planet.x, -this.planet.y);

                // Update & Draw Explosion Particles (Inside scaled context)
                this.explosionParticles = this.explosionParticles.filter(p => p.alpha > 0);
                this.explosionParticles.forEach(p => {
                    p.update(1 / 60);
                    p.draw(this.ctx);
                });

                // Star Field (Stars don't zoom for parallax effect)
                this.ctx.save();
                this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Reset transform for stars

                // Star Field (Pre-generated for high quality randomness)
                this.stars.forEach((star, i) => {
                    const sx = star.x * this.canvas.width;
                    const sy = star.y * this.canvas.height;
                    const twinkle = 0.6 + Math.sin(Date.now() * star.twinkleSpeed + star.phase) * 0.4;

                    this.ctx.fillStyle = star.color;
                    this.ctx.globalAlpha = star.brightness * twinkle;
                    this.ctx.fillRect(sx, sy, star.size, star.size);
                });
                this.ctx.globalAlpha = 1.0;
                this.ctx.restore(); // Restore to scaled coordinates

                // Layered Nebulae for "Bling-Bling" effect
                this.ctx.save();
                this.ctx.setTransform(1, 0, 0, 1, 0, 0);

                // Layer 1: Core Purple Glow
                const nebula1 = this.ctx.createRadialGradient(
                    this.planet.x - 200 * this.zoom, this.planet.y + 100 * this.zoom, 0,
                    this.planet.x - 200 * this.zoom, this.planet.y + 100 * this.zoom, 800 * this.zoom
                );
                nebula1.addColorStop(0, 'rgba(124, 58, 237, 0.12)');
                nebula1.addColorStop(1, 'rgba(0, 0, 0, 0)');
                this.ctx.fillStyle = nebula1;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Layer 2: Subtle Cyan Accent
                const nebula2 = this.ctx.createRadialGradient(
                    this.planet.x + 300 * this.zoom, this.planet.y - 150 * this.zoom, 0,
                    this.planet.x + 300 * this.zoom, this.planet.y - 150 * this.zoom, 700 * this.zoom
                );
                nebula2.addColorStop(0, 'rgba(6, 182, 212, 0.08)');
                nebula2.addColorStop(1, 'rgba(0, 0, 0, 0)');
                this.ctx.fillStyle = nebula2;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Layer 3: Warm Gold Mist
                const nebula3 = this.ctx.createRadialGradient(
                    this.planet.x, this.planet.y, 100 * this.zoom,
                    this.planet.x, this.planet.y, 1000 * this.zoom
                );
                nebula3.addColorStop(0, 'rgba(234, 179, 8, 0.04)');
                nebula3.addColorStop(1, 'rgba(0, 0, 0, 0)');
                this.ctx.fillStyle = nebula3;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                this.ctx.restore();

                // Planet
                const grad = this.ctx.createRadialGradient(this.planet.x, this.planet.y, 10, this.planet.x, this.planet.y, CONFIG.PLANET_RADIUS);
                grad.addColorStop(0, '#a855f7');
                grad.addColorStop(0.5, '#6b21a8');
                grad.addColorStop(1, '#1e1b4b');

                this.ctx.shadowBlur = 40;
                this.ctx.shadowColor = '#a855f7';
                this.ctx.beginPath();
                this.ctx.arc(this.planet.x, this.planet.y, CONFIG.PLANET_RADIUS, 0, Math.PI * 2);
                this.ctx.fillStyle = grad;
                this.ctx.fill();
                this.ctx.shadowBlur = 0;

                this.particles.forEach(p => p.draw(this.ctx));
                this.ctx.restore(); // Restore main scale
            }

            updateUI() {
                let sorted = [...this.particles];
                if (this.winCondition === 'survival') {
                    sorted.sort((a, b) => {
                        if (a.isEliminated !== b.isEliminated) return a.isEliminated ? 1 : -1;
                        if (!a.isEliminated) return b.minDist - a.minDist; // Safer (further) orbits higher
                        return b.survivalTime - a.survivalTime;
                    });
                } else if (this.winCondition === 'stability') {
                    this.calculateStability();
                    sorted.sort((a, b) => b.score - a.score);
                } else if (this.winCondition === 'target') {
                    this.calculateTargetScore();
                    sorted.sort((a, b) => b.score - a.score);
                }

                // Update Global Timer
                const timerEl = document.getElementById('gameTimer');
                if (this.isRunning) {
                    timerEl.classList.add('active');
                    timerEl.innerText = this.gameTime.toFixed(2) + "s";
                } else {
                    timerEl.classList.remove('active');
                }

                const list = document.getElementById('rankingList');
                list.innerHTML = sorted.map((p, i) => `
                    <div class="ranking-item">
                        <div class="rank ${i < 3 ? 'rank-' + (i + 1) : ''}">${i + 1}</div>
                        <div class="particle-color" style="background:${p.color}; box-shadow: 0 0 5px ${p.color}"></div>
                        <div class="name">${p.name}</div>
                        <div class="metrics"></div>
                        <div class="status ${p.isEliminated ? 'eliminated' : ''}">
                            ${p.isEliminated ? p.survivalTime.toFixed(3) + 's' : `MIN:${Math.round(p.minDist)}`}
                        </div>
                    </div>
                `).join('');
            }

            calculateStability() {
                this.particles.forEach(p => {
                    if (p.isEliminated || p.orbitPoints.length < 5) return;
                    const radii = p.orbitPoints.map(pt => pt.d);
                    const mean = radii.reduce((a, b) => a + b, 0) / radii.length;
                    const variance = radii.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / radii.length;
                    // Lower variance = Higher score. We use a reciprocal with a floor.
                    p.score = p.survivalTime * 10 + (20000 / (variance + 1));
                });
            }

            calculateTargetScore() {
                this.particles.forEach(p => {
                    if (p.isEliminated) return;
                    const lastPt = p.orbitPoints[p.orbitPoints.length - 1];
                    if (!lastPt) return;

                    const distFromTarget = Math.abs(lastPt.d - CONFIG.TARGET_RADIUS);
                    if (distFromTarget < CONFIG.TARGET_WIDTH / 2) {
                        p.score += 5; // Rapid accumulation within ring
                    }
                });
            }

            endGame() {
                if (!this.isRunning) return;
                this.isRunning = false;
                this.sound.playWin();
                document.getElementById('startBtn').disabled = false;
                document.getElementById('liveStatus').style.display = "none";

                let sorted = [...this.particles];
                if (this.winCondition === 'survival') {
                    sorted.sort((a, b) => b.survivalTime - a.survivalTime);
                } else {
                    sorted.sort((a, b) => b.score - a.score);
                }

                const count = parseInt(document.getElementById('winnerCount').value) || 1;
                const top = sorted.slice(0, count);
                const winnerNames = top.map(w => w.name).join(', ');

                // Update UI Elements
                document.getElementById('winnerName').innerText = winnerNames;

                // Generate Ranking List for UI
                const rankList = document.getElementById('finalRankingList');
                rankList.innerHTML = "";
                sorted.forEach((p, i) => {
                    const rankClass = i < 3 ? `rank-${i + 1}` : "";
                    const status = p.isEliminated ? `${p.survivalTime.toFixed(2)}s` : "SURVIVED";
                    const item = document.createElement('div');
                    item.className = `final-ranking-item ${rankClass}`;
                    item.style.animationDelay = `${i * 0.1}s`;
                    item.innerHTML = `
                        <div class="final-pos">${i + 1}</div>
                        <div class="final-name">${p.name}</div>
                        <div class="final-score">${status}</div>
                    `;
                    rankList.appendChild(item);
                });

                document.getElementById('resultOverlay').classList.add('active');
                this.createConfetti();
            }

            createConfetti() {
                const colors = ['#a855f7', '#38bdf8', '#fbbf24', '#f472b6', '#ffffff'];
                for (let i = 0; i < 150; i++) {
                    this.celebParticles.push({
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * -window.innerHeight,
                        vx: (Math.random() - 0.5) * 10,
                        vy: Math.random() * 5 + 5,
                        size: Math.random() * 10 + 5,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        rotation: Math.random() * Math.PI * 2,
                        rVel: (Math.random() - 0.5) * 0.2
                    });
                }
            }

            updateCelebration() {
                if (!this.isCelebrating) return;
                this.celebParticles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.rotation += p.rVel;
                    if (p.y > window.innerHeight) {
                        p.y = -20;
                        p.x = Math.random() * window.innerWidth;
                    }
                });
            }

            drawCelebration() {
                this.celebCtx.clearRect(0, 0, this.celebCanvas.width, this.celebCanvas.height);
                if (!this.isCelebrating) return;

                this.celebParticles.forEach(p => {
                    this.celebCtx.save();
                    this.celebCtx.translate(p.x, p.y);
                    this.celebCtx.rotate(p.rotation);
                    this.celebCtx.fillStyle = p.color;
                    this.celebCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                    this.celebCtx.restore();
                });
            }

            closeResult() {
                this.isCelebrating = false;
                this.celebParticles = [];
                this.celebCtx.clearRect(0, 0, this.celebCanvas.width, this.celebCanvas.height);
                document.getElementById('resultOverlay').classList.remove('active');
            }

            reset() {
                this.isRunning = false;
                this.isCelebrating = false;
                this.celebParticles = [];
                this.celebCtx.clearRect(0, 0, this.celebCanvas.width, this.celebCanvas.height);
                this.particles = [];
                this.gameTime = 0;
                this.lastTime = 0;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('liveStatus').style.display = "none";
                document.getElementById('seedDisplay').style.display = "none";
                document.getElementById('rankingList').innerHTML = '<div style="text-align: center; color: #555; font-size: 13px; margin-top: 20px;">Ï∞∏Ïó¨ÏûêÎ•º ÏûÖÎ†•ÌïòÍ≥† ÏãúÏûëÌïòÏÑ∏Ïöî</div>';
                document.getElementById('resultOverlay').classList.remove('active');
                document.getElementById('killFeed').innerHTML = ""; // Clear feed on reset
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }

            createExplosion(x, y, color) {
                for (let i = 0; i < 20; i++) {
                    this.explosionParticles.push(new ExplosionParticle(x, y, color));
                }
            }

            addKillMessage(name, reason) {
                const feed = document.getElementById('killFeed');
                const item = document.createElement('div');
                item.className = 'kill-item';

                let message = "";
                if (reason === "CRASHED") {
                    const msgs = [
                        "ÎãòÏù¥ ÌñâÏÑ±Ïóê Ï∂©ÎèåÌïòÏó¨ ÌååÍ¥¥ÎêòÏóàÏäµÎãàÎã§. üí•",
                        "ÎãòÏù¥ Ï§ëÎ†•ÏùÑ Í≤¨ÎîîÏßÄ Î™ªÌïòÍ≥† Ï∂îÎùΩÌñàÏäµÎãàÎã§. üî•",
                        "ÎãòÏù¥ ÌñâÏÑ± ÌëúÎ©¥Ïóê ÏÜåÎ©∏ÎêòÏóàÏäµÎãàÎã§. ‚òÑÔ∏è"
                    ];
                    message = msgs[Math.floor(Math.random() * msgs.length)];
                } else {
                    const msgs = [
                        "ÎãòÏù¥ Í∂§ÎèÑÎ•º Ïù¥ÌÉàÌïòÏó¨ Ïã§Ï¢ÖÎêòÏóàÏäµÎãàÎã§. üì°",
                        "ÎãòÏù¥ Î®º Ïö∞Ï£ºÎ°ú ÌäïÍ≤®ÎÇòÍ∞Ä ÏÇ¨ÎùºÏ°åÏäµÎãàÎã§. ‚ú®",
                        "ÎãòÏù¥ Ïã¨Ïö∞Ï£ºÎ°ú ÏÇ¨ÎùºÏ†∏ ÌñâÎ∞©Î∂àÎ™ÖÎêòÏóàÏäµÎãàÎã§. üåå"
                    ];
                    message = msgs[Math.floor(Math.random() * msgs.length)];
                }

                item.innerHTML = `<span style="font-weight: 800; color: #fff; margin-right: 4px;">${name}</span>${message}`;
                feed.insertBefore(item, feed.firstChild);

                // Auto remove from DOM after animation
                setTimeout(() => {
                    if (item.parentElement === feed) {
                        feed.removeChild(item);
                    }
                }, 4500);

                // Limit count
                while (feed.children.length > 5) {
                    feed.removeChild(feed.lastChild);
                }
            }
        }

        /**
         * 4. Initialization
         */
        const game = new Game();
                    document.getElementById('startBtn').onclick = () => {
                        game.start();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };        document.getElementById('resetBtn').onclick = () => game.reset();
        document.getElementById('restartBtn').onclick = () => game.closeResult();

        document.getElementById('copyResultOverlayBtn').onclick = () => {
            const btn = document.getElementById('copyResultBtn');
            btn.click();
        };

        // LocalStorage logic
        const STORAGE_KEY = 'gravity_orbit_settings';
        function saveSettings() {
            const settings = {
                participants: document.getElementById('participantsInput').value,
                winCondition: document.getElementById('winCondition').value,
                winnerCount: document.getElementById('winnerCount').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('participantsInput').value = settings.participants || "ÏòÅÏàò, ÏòÅÌò∏, ÏòÅÏãù, ÏòÅÏ≤†, Í¥ëÏàò, ÏÉÅÏ≤†";
                document.getElementById('winCondition').value = settings.winCondition || "survival";
                document.getElementById('winnerCount').value = settings.winnerCount || "1";
            } else {
                document.getElementById('participantsInput').value = "ÏòÅÏàò, ÏòÅÌò∏, ÏòÅÏãù, ÏòÅÏ≤†, Í¥ëÏàò, ÏÉÅÏ≤†";
            }
        }

        document.getElementById('participantsInput').oninput = saveSettings;
        document.getElementById('winCondition').onchange = saveSettings;
        document.getElementById('winnerCount').onchange = saveSettings;
        loadSettings();

        // Copy Results
        document.getElementById('copyResultBtn').onclick = () => {
            if (!game.particles.length) return;

            let sorted = [...game.particles];
            if (game.winCondition === 'survival') {
                sorted.sort((a, b) => b.survivalTime - a.survivalTime);
            } else {
                sorted.sort((a, b) => b.score - a.score);
            }

            const winnerCount = parseInt(document.getElementById('winnerCount').value) || 1;
            const winners = sorted.slice(0, winnerCount).map(p => p.name).join(', ');

            let resultText = `ü™ê Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ Ï∂îÏ≤® Í≤∞Í≥º\n`;
            resultText += `ÎãπÏ≤®Ïûê: ${winners}\n\n`;
            resultText += `[Ï†ÑÏ≤¥ ÏàúÏúÑ]\n`;

            sorted.forEach((p, i) => {
                const status = p.isEliminated ? `${p.survivalTime.toFixed(3)}s` : 'ÏÉùÏ°¥ (ALIVE)';
                resultText += `${i + 1}ÏúÑ. ${p.name} (${status})\n`;
            });

            navigator.clipboard.writeText(resultText).then(() => showToast("Ï†ÑÏ≤¥ Í≤∞Í≥ºÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! ‚ú®"));
        };

        // Help Modal (Simple alert for brevity, or full modal if needed)
        document.getElementById('helpBtn').onclick = () => {
            alert("ü™ê Ï§ëÎ†• Í∂§ÎèÑ ÏÉùÏ°¥ Ï∂îÏ≤® Í∞ÄÏù¥Îìú\n\n1. Ï∞∏Ïó¨ÏûêÎ•º ÏûÖÎ†•Ìï©ÎãàÎã§ (ÏâºÌëú/Ï§ÑÎ∞îÍøà Íµ¨Î∂Ñ).\n2. ÎãπÏ≤® Í∑úÏπôÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.\n   - ÏÑúÎ∞îÏù¥Î≤å: ÌÉúÏñëÏóê Ï∂©ÎèåÌïòÍ±∞ÎÇò ÌäïÍ≤®ÎÇòÍ∞ÄÏßÄ ÏïäÍ≥† ÏÉùÏ°¥\n   - ÏïàÏ†ïÏÑ±: Í∂§ÎèÑÍ∞Ä ÏñºÎßàÎÇò ÏùºÏ†ïÌïú ÏõêÌòïÏù∏Í∞Ä\n   - ÌÉÄÍ≤ü: ÌäπÏ†ï Í∂§ÎèÑ Î≤îÏúÑ(ÌïòÎäòÏÉâ)Ïóê Ïò§Îûò Î®∏Î¨ºÍ∏∞\n3. ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Seed Í∏∞Î∞ò Î¨ºÎ¶¨ ÏãúÎÆ¨Î†àÏù¥ÏÖòÏù¥ ÏßÑÌñâÎê©ÎãàÎã§.");
        };
    </script>
    <div id="toast">
        <span class="toast-icon">‚úÖ</span>
        <span class="toast-text">Í≤∞Í≥ºÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!</span>
    </div>
</body>

</html>